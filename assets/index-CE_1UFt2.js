import{u as T,a as O,g as Q,I as W,b as X,c as Y,f as S,d as Z,e as ee,_ as x}from"./index-gvRuJhl_.js";import{_ as te}from"./queryIpLink.vue_vue_type_script_setup_true_lang-BYzWFW1A.js";import{f as P,a as ae,a7 as N,ak as ne,w,c as y,s as A,a3 as o,t,y as a,m as I,x as s,v as c,k as C}from"./libs-BYIN-Nlk.js";import{t as oe,e as le,S as $,T as k,K as se,a5 as re}from"./arcoDesign-CWLifbdQ.js";import{I as ie}from"./index-LMbWXuwu.js";import"./uuid-5hg4BtTT.js";async function ce(i){const l=T();await l.serverAvailable;const r=new URL(O(l.endpoint,"api/bans/logs"),location.href);return r.searchParams.set("page",String(i.page)),i.pageSize&&r.searchParams.set("pageSize",String(i.pageSize)),i.sorter&&r.searchParams.set("orderBy",i.sorter),fetch(r,{headers:Q()}).then(n=>(l.assertResponseLogin(n),n.json()))}const pe=P({__name:"banlogTable",setup(i){const l=ae(!0),r=T(),{t:n,d}=N(),{data:b,total:D,current:u,loading:U,pageSize:_,changeCurrent:B,changePageSize:K,refresh:H,run:z}=ne(ce,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:p=>`${r.endpoint}-banlogs-${p?.[0].page||1}-${p?.[0].pageSize||10}`,onAfter:()=>{l.value=!1}},[ee]);w([_,u],()=>{l.value=!0}),w(()=>r.endpoint,H);const L=y(()=>l.value||U.value||!v.value),V=[{title:()=>n("page.banlog.banlogTable.column.banTime")+"/"+n("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",dataIndex:"banAt",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:210},{title:()=>n("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",width:230},{title:()=>n("page.banlog.banlogTable.column.peerId"),slotName:"peerId",width:120},{title:()=>n("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",dataIndex:"peerUploaded",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:150},{title:()=>n("page.banlog.banlogTable.column.torrentName"),dataIndex:"torrentName",slotName:"torrentName",ellipsis:!0,tooltip:!0},{title:()=>n("page.banlog.banlogTable.column.torrentSize"),slotName:"torrentSize",dataIndex:"torrentSize",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:120},{title:()=>n("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],v=y(()=>b.value?.data.results),j=(p,f)=>{z(f?{page:u.value,pageSize:_.value,sorter:`${p}|${f}`}:{page:u.value,pageSize:_.value})};return(p,f)=>{const F=ie,g=k,R=re,h=$,E=X,J=Y,q=se,m=le,G=W,M=oe;return C(),A(M,{stripe:!0,columns:V,data:v.value,loading:L.value,pagination:{total:o(D),current:o(u),pageSize:o(_),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onSorterChange:j,onPageChange:o(B),onPageSizeChange:o(K)},{banAt:t(({record:e})=>[a(h,{fill:"",direction:"vertical"},{default:t(()=>[a(g,null,{default:t(()=>[a(F),c(" "+s(o(d)(e.banAt,"long")),1)]),_:2},1024),a(g,null,{default:t(()=>[a(R),c(" "+s(e.unbanAt?o(d)(e.unbanAt,"long"):o(n)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:t(({record:e})=>[a(g,{copyable:"",code:""},{default:t(()=>[a(te,{ip:e.peerIp,style:{color:"var(--color-text-2)"}},{default:t(()=>[c(s(o(Z)(e.peerIp,e.peerPort)),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:t(({record:e})=>[a(h,{fill:"",style:{"justify-content":"space-between"}},{default:t(()=>[a(h,{fill:"",direction:"vertical"},{default:t(()=>[a(g,null,{default:t(()=>[a(E,{class:"green"}),c(" "+s(o(S)(e.peerUploaded)),1)]),_:2},1024),a(g,null,{default:t(()=>[a(J,{class:"red"}),c(" "+s(o(S)(e.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),a(m,{content:(e.peerProgress*100).toFixed(2)+"%"},{default:t(()=>[a(q,{percent:e.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:t(({record:e})=>[I("p",null,[c(s(e.peerId?e.peerId:o(n)("page.banlist.banlist.listItem.empty"))+" ",1),a(m,{content:e.peerClientName?e.peerClientName:o(n)("page.banlist.banlist.listItem.empty")},{default:t(()=>[a(G)]),_:2},1032,["content"])])]),torrentName:t(({record:e})=>[a(m,{content:o(n)("page.banlog.banlogTable.column.torrentName.tooltip",{downloader:e.downloader?.name,hash:e.torrentInfoHash})},{default:t(()=>[I("p",null,s(e.torrentName),1)]),_:2},1032,["content"])]),torrentSize:t(({record:e})=>[a(m,{content:`Hash: ${e.torrentInfoHash}`},{default:t(()=>[I("p",null,s(o(S)(e.torrentSize)),1)]),_:2},1032,["content"])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])}}}),ge=x(pe,[["__scopeId","data-v-fd4ae9fa"]]),de=P({__name:"index",setup(i){const{t:l}=N();return(r,n)=>{const d=k,b=$;return C(),A(b,{direction:"vertical",fill:""},{default:t(()=>[a(d,{style:{"font-size":"1.2em"}},{default:t(()=>[c(s(o(l)("page.banlog.description")),1)]),_:1}),a(ge)]),_:1})}}}),Se=x(de,[["__scopeId","data-v-e1fde76f"]]);export{Se as default};
