const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dummyChart-D3qYsiOl.js","./echarts-BCfjw-BL.js","./libs-CGCN05bf.js","./index-DgfpHrne.js","./arcoDesign-oXuB2kqy.js","./uuid-BMzgKRou.js","./index-CPJN9c_R.css"])))=>i.map(i=>d[i]);
import{u as z,a as X,g as J,q as G,r as we,_ as xe,f as fe,s as Se}from"./index-DgfpHrne.js";import{f as E,a8 as I,c as V,a as B,r as K,w as F,ac as M,s as h,k as _,a9 as e,t as o,y as l,v as m,x as f,u as N,l as Te,m as Ce,ad as Ve,j as Oe,P as Be,F as Pe}from"./libs-CGCN05bf.js";import{a as w,C as H,aq as W,f as j,E as Q,ab as re,L as de,H as Y,J as Z,aB as le,K as ge,O as _e,S as me,w as he,T as ye,e as ke,$ as be,U as Ae,R as Ue,W as Re,az as Le,aC as Ee,V as Ie}from"./arcoDesign-oXuB2kqy.js";import{u as ee,s as te,i as ae,a as ce,b as pe,c as oe,d as ue,e as ve,f as De}from"./echarts-BCfjw-BL.js";import{I as $e}from"./index-4IWmHI0u.js";import{u as je}from"./userStore-Bjp7pItA.js";import"./uuid-BMzgKRou.js";async function qe(y,s=!1,i){const r=z();await r.serverAvailable;const a=new URLSearchParams({type:"count",field:y,filter:s?"0.01":"0"});i&&a.append("downloader",i);const g=new URL(X(r.endpoint,"api/statistic/analysis/field?"+a.toString()),location.href);return fetch(g,{headers:J()}).then(d=>(r.assertResponseLogin(d),d.json()))}async function Ne(y,s,i,r){const a=z();await a.serverAvailable;const g=new URL(X(a.endpoint,"api/chart/geoIpInfo"),location.href),d=y.getTime(),p=s.getTime();return g.searchParams.append("startAt",d.toString()),g.searchParams.append("endAt",p.toString()),g.searchParams.append("bannedOnly",String(i)),r&&g.searchParams.append("downloader",r),fetch(g,{headers:J()}).then(u=>(a.assertResponseLogin(u),u.json()))}async function ze(y,s,i){const r=z();await r.serverAvailable;const a=new URLSearchParams({startAt:y.getTime().toString(),endAt:s.getTime().toString()});i&&a.append("downloader",i);const g=new URL(X(r.endpoint,"api/statistic/analysis/banTrends?"+a.toString()),location.href);return fetch(g,{headers:J()}).then(d=>(r.assertResponseLogin(d),d.json()))}async function Fe(y,s,i){const r=z();await r.serverAvailable;const a=new URLSearchParams({startAt:y.getTime().toString(),endAt:s.getTime().toString()});i&&a.append("downloader",i);const g=new URL(X(r.endpoint,"api/chart/trend?"+a.toString()),location.href);return fetch(g,{headers:J()}).then(d=>(r.assertResponseLogin(d),d.json()))}async function Me(y,s,i){const r=z();await r.serverAvailable;const a=new URLSearchParams({startAt:y.getTime().toString(),endAt:s.getTime().toString()});i&&a.append("downloader",i);const g=new URL(X(r.endpoint,"api/chart/traffic?"+a.toString()),location.href);return fetch(g,{headers:J()}).then(d=>(r.assertResponseLogin(d),d.json()))}async function He(y,s,i){const r=z();await r.serverAvailable;const a=new URLSearchParams({startAt:y.getTime().toString(),endAt:s.getTime().toString()});i&&a.append("downloader",i);const g=new URL(X(r.endpoint,"api/chart/sessionAnalyse?"+a.toString()),location.href);return fetch(g,{headers:J()}).then(d=>(r.assertResponseLogin(d),d.json()))}const We=E({__name:"banTrends",props:{downloader:{}},setup(y){const{t:s}=I(),i=V(()=>({text:s("page.charts.loading"),color:r.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:r.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:r.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),r=G(),a=B();ee([ae,ce,pe,oe]);const g=y,d=K({range:[w().startOf("day").add(-7,"day").toDate(),new Date]}),p=V(()=>({tooltip:{trigger:"axis",backgroundColor:r.isDark?"#333335":"#ffffff",borderColor:r.isDark?"#333335":"#ffffff",textStyle:{color:r.isDark?"rgba(255, 255, 255, 0.7)":void 0}},backgroundColor:r.isDark?"rgba(0, 0, 0, 0.0)":void 0,...u.value})),u=B({xAxis:{type:"time",max:"dataMax"},yAxis:{type:"value"},grid:{left:"15%"},series:[{data:[],type:"line",name:s("page.charts.line.options.field")}]});F(d,c=>{b(c.range[0],c.range[1],g.downloader)});const{loading:D,run:b,refresh:O,data:S}=M(ze,{defaultParams:[w().startOf("day").add(-7,"day").toDate(),new Date,g.downloader],onSuccess:c=>{c.data&&(u.value.series[0].data=c.data.sort((n,t)=>n.key-t.key).map(n=>[new Date(n.key),n.value]))},onError:c=>{a.value=c}});return(c,n)=>{const t=de,k=le,v=Z,x=Y,T=re,A=j,C=W,P=Q,U=H;return _(),h(U,{hoverable:"",title:e(s)("page.charts.title.line")},{extra:o(()=>[l(T,null,{content:o(()=>[l(x,{model:d},{default:o(()=>[l(v,{field:"range",label:e(s)("page.charts.options.days"),"label-col-flex":"100px"},{default:o(()=>[l(k,{modelValue:d.range,"onUpdate:modelValue":n[0]||(n[0]=R=>d.range=R),"show-time":"","value-format":"Date",shortcuts:[{label:e(s)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(s)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(s)("page.charts.options.shortcut.30days"),value:()=>[e(w)().startOf("day").add(-30,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:o(()=>[l(t,null,{default:o(()=>[m(f(e(s)("page.charts.options.more")),1)]),_:1})]),_:1})]),default:o(()=>[a.value?(_(),h(C,{key:0,status:"500",title:e(s)("page.charts.error.title"),class:"chart chart-error"},{subtitle:o(()=>[m(f(a.value.message),1)]),extra:o(()=>[l(A,{type:"primary",onClick:n[1]||(n[1]=()=>{a.value=void 0,e(O)()})},{default:o(()=>[m(f(e(s)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):!e(D)&&(!e(S)?.data||e(S).data.length===0)?(_(),h(P,{key:1,class:"chart",style:{"align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}})):(_(),h(e(te),{key:2,class:"chart",option:p.value,loading:e(D),"loading-options":i.value,theme:e(r).isDark?"dark":"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),Xe=E({__name:"fieldPie",props:{downloader:{}},setup(y){const{t:s}=I();ee([ae,ue,ve,oe]);const i=G(),r=K({field:"peerId",enableThreshold:!0,mergeSameVersion:!1}),a=V(()=>({text:s("page.charts.loading"),color:i.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:i.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:i.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),g=B(),d=V(()=>({tooltip:{trigger:"item",appendToBody:!0,formatter:'<p style="word-wrap:break-all"><b>{b}</b></p>  {c} ({d}%)',backgroundColor:i.isDark?"#333335":"#ffffff",borderColor:i.isDark?"#333335":"#ffffff",textStyle:{color:i.isDark?"rgba(255, 255, 255, 0.7)":void 0}},backgroundColor:i.isDark?"rgba(0, 0, 0, 0.0)":void 0,...p.value})),p=B({legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[],textStyle:{overflow:"truncate",width:100},tooltip:{show:!0}},series:[{name:s("page.charts.options.field."+r.field),type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});F(r,c=>{b(c.field,c.enableThreshold,u.downloader)});const u=y,{loading:D,run:b,refresh:O,data:S}=M(qe,{defaultParams:["peerId",!0,u.downloader],onSuccess:c=>{if(c.data){const n=c.data.map(t=>(t.data===""&&(t.data=s("page.charts.options.field.empty")),t));if(r.mergeSameVersion&&r.field==="peerId"){const t=new Map;n.forEach(k=>{let v=k.data;const x=v.match(/^([-]?[a-zA-z]+)[0-9]+.*/);x&&x?.length>=2&&(v=x[1]+"*"),t.has(v)?t.set(v,t.get(v)+k.count):t.set(v,k.count)}),p.value.legend.data=[],p.value.series[0].data=[],Array.from(t).forEach(([k,v])=>{p.value.legend.data.push(k),p.value.series[0].data.push({name:k,value:v})})}else p.value.legend.data=n.map(t=>t.data),p.value.series[0].data=n.map(t=>({name:t.data,value:t.count}))}},onError:c=>{g.value=c}});return(c,n)=>{const t=j,k=W,v=Q,x=de,T=_e,A=ge,C=Z,P=he,U=ye,R=me,$=Y,se=re,ne=H;return _(),h(ne,{hoverable:"",title:e(s)("page.charts.options.field."+r.field)},{extra:o(()=>[l(se,null,{content:o(()=>[l($,{model:r,style:{width:"25vh"}},{default:o(()=>[l(C,{field:"field",label:e(s)("page.charts.options.field")},{default:o(()=>[l(A,{modelValue:r.field,"onUpdate:modelValue":n[1]||(n[1]=q=>r.field=q),"trigger-props":{autoFitPopupMinWidth:!0}},{default:o(()=>[l(T,{value:"peerId"},{default:o(()=>[m(f(e(s)("page.charts.options.field.peerId")),1)]),_:1}),l(T,{value:"torrentName"},{default:o(()=>[m(f(e(s)("page.charts.options.field.torrentName")),1)]),_:1}),l(T,{value:"module"},{default:o(()=>[m(f(e(s)("page.charts.options.field.module")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(C,{field:"enableThreshold"},{default:o(()=>[l(R,null,{default:o(()=>[l(P,{modelValue:r.enableThreshold,"onUpdate:modelValue":n[2]||(n[2]=q=>r.enableThreshold=q)},null,8,["modelValue"]),l(U,null,{default:o(()=>[m(f(e(s)("page.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1}),r.field==="peerId"?(_(),h(C,{key:0,field:"mergeSameVersion"},{default:o(()=>[l(R,null,{default:o(()=>[l(P,{modelValue:r.mergeSameVersion,"onUpdate:modelValue":n[3]||(n[3]=q=>r.mergeSameVersion=q)},null,8,["modelValue"]),l(U,null,{default:o(()=>[m(f(e(s)("page.charts.options.mergeSame")),1)]),_:1})]),_:1})]),_:1})):N("",!0)]),_:1},8,["model"])]),default:o(()=>[l(x,null,{default:o(()=>[m(f(e(s)("page.charts.options.more")),1)]),_:1})]),_:1})]),default:o(()=>[g.value?(_(),h(k,{key:0,status:"500",title:e(s)("page.charts.error.title"),class:"chart chart-error"},{subtitle:o(()=>[m(f(g.value.message),1)]),extra:o(()=>[l(t,{type:"primary",onClick:n[0]||(n[0]=()=>{g.value=void 0,e(O)()})},{default:o(()=>[m(f(e(s)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):!e(D)&&(!e(S)?.data||e(S).data.length===0)?(_(),h(v,{key:1,class:"chart",style:{"align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}})):(_(),h(e(te),{key:2,class:"chart",option:d.value,loading:e(D),autoresize:"","loading-options":a.value,theme:e(i).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),Je=E({__name:"ispPie",props:{downloader:{}},setup(y){const{t:s}=I();ee([ae,ue,ve,oe]);const i=G(),r=B(),a=K({field:"isp",enableThreshold:!0,bannedOnly:!0,range:[w().startOf("day").add(-14,"day").toDate(),new Date]}),g=V(()=>({text:s("page.charts.loading"),color:i.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:i.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:i.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),d=V(()=>({tooltip:{trigger:"item",appendToBody:!0,formatter:'<p style="word-wrap:break-all"><b>{b}</b></p>  {c} ({d}%)',backgroundColor:i.isDark?"#333335":"#ffffff",borderColor:i.isDark?"#333335":"#ffffff",textStyle:{color:i.isDark?"rgba(255, 255, 255, 0.7)":void 0}},backgroundColor:i.isDark?"rgba(0, 0, 0, 0.0)":void 0,...p.value})),p=B({legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[],textStyle:{overflow:"truncate",width:100},tooltip:{show:!0}},series:[{name:"",type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]});F(a,c=>{b(c.range[0],c.range[1],a.bannedOnly,u.downloader)});const u=y,{loading:D,run:b,refresh:O,data:S}=M(Ne,{defaultParams:[a.range[0],a.range[1],a.bannedOnly,u.downloader],onSuccess:c=>{if(c.data){const n=c.data[a.field];let t;if(a.enableThreshold){const v=n.reduce((x,T)=>x+T.value,0)*.01;t=n.filter(x=>x.value>=v)}else t=n;p.value.legend.data=t.map(k=>k.key),p.value.series[0].data=t.map(k=>({name:k.key==="N/A"&&a.field==="province"?s("page.charts.data.province.na"):k.key,value:k.value})),p.value.series[0].name=s("page.charts.options.field."+a.field)}},onError:c=>{r.value=c}});return(c,n)=>{const t=j,k=W,v=Q,x=de,T=_e,A=ge,C=Z,P=le,U=he,R=ye,$=me,se=Y,ne=re,q=H;return _(),h(q,{hoverable:"",title:e(s)("page.charts.title.geoip")+(a.bannedOnly?e(s)("page.charts.subtitle.bannedOnly"):"")},{extra:o(()=>[l(ne,null,{content:o(()=>[l(se,{model:a},{default:o(()=>[l(C,{field:"field",label:e(s)("page.charts.options.field")},{default:o(()=>[l(A,{modelValue:a.field,"onUpdate:modelValue":n[1]||(n[1]=L=>a.field=L),"trigger-props":{autoFitPopupMinWidth:!0}},{default:o(()=>[l(T,{value:"isp"},{default:o(()=>[m(f(e(s)("page.charts.options.field.isp")),1)]),_:1}),l(T,{value:"province"},{default:o(()=>[m(f(e(s)("page.charts.options.field.province")),1)]),_:1}),l(T,{value:"city"},{default:o(()=>[m(f(e(s)("page.charts.options.field.city")),1)]),_:1}),l(T,{value:"region"},{default:o(()=>[m(f(e(s)("page.charts.options.field.region")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(C,{field:"range",label:e(s)("page.charts.options.days")},{default:o(()=>[l(P,{modelValue:a.range,"onUpdate:modelValue":n[2]||(n[2]=L=>a.range=L),"show-time":"","value-format":"Date",shortcuts:[{label:e(s)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(s)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(s)("page.charts.options.shortcut.30days"),value:()=>[e(w)().startOf("day").add(-30,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"]),l(C,{field:"enableThreshold"},{default:o(()=>[l($,null,{default:o(()=>[l(U,{modelValue:a.enableThreshold,"onUpdate:modelValue":n[3]||(n[3]=L=>a.enableThreshold=L)},null,8,["modelValue"]),l(R,null,{default:o(()=>[m(f(e(s)("page.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1}),l(C,{field:"bannedOnly"},{default:o(()=>[l($,null,{default:o(()=>[l(U,{modelValue:a.bannedOnly,"onUpdate:modelValue":n[4]||(n[4]=L=>a.bannedOnly=L)},null,8,["modelValue"]),l(R,null,{default:o(()=>[m(f(e(s)("page.charts.options.bannedOnly")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),default:o(()=>[l(x,null,{default:o(()=>[m(f(e(s)("page.charts.options.more")),1)]),_:1})]),_:1})]),default:o(()=>[r.value?(_(),h(k,{key:0,status:"500",title:e(s)("page.charts.error.title"),class:"chart chart-error"},{subtitle:o(()=>[m(f(r.value.message),1)]),extra:o(()=>[l(t,{type:"primary",onClick:n[0]||(n[0]=()=>{r.value=void 0,e(O)()})},{default:o(()=>[m(f(e(s)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):!e(D)&&(!e(S)?.data||Object.values(e(S).data).every(L=>L.length===0))?(_(),h(v,{key:1,class:"chart",style:{"align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}})):(_(),h(e(te),{key:2,class:"chart",option:d.value,loading:e(D),autoresize:"","loading-options":g.value,theme:e(i).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),Ge={class:"card-body-wrapper"},Ke=E({__name:"plusWarpper",props:{title:{}},setup(y){const s=Ve(()=>we(()=>import("./dummyChart-D3qYsiOl.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url)),{t:i}=I(),r=z(),a=()=>{r.emitter.emit("open-plus-modal")};return(g,d)=>{const p=$e,u=j,D=W,b=H;return e(r).plusStatus?.enabledFeatures?.includes("basic")?Te(g.$slots,"default",{key:0},void 0,!0):(_(),h(b,{key:1,hoverable:"",title:y.title,class:"card-container"},{default:o(()=>[Ce("div",Ge,[l(D,{class:"overlay",status:"warning",title:e(i)("page.charts.locked")},{icon:o(()=>[l(p)]),subtitle:o(()=>[m(f(e(i)("page.charts.locked.tips")),1)]),extra:o(()=>[l(u,{type:"primary",onClick:a},{default:o(()=>[m(f(e(i)("page.charts.locked.active")),1)]),_:1})]),_:1},8,["title"]),l(e(s))])]),_:1},8,["title"]))}}}),ie=xe(Ke,[["__scopeId","data-v-bf0062e0"]]),Qe=E({__name:"sessionDayBucket",props:{downloader:{}},setup(y){ee([ae,ue,De,pe,ce,oe]);const s=K({range:[w().startOf("day").add(-7,"day").toDate(),new Date]}),i=G(),r=V(()=>({text:a("page.charts.loading"),color:i.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:i.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:i.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),{t:a,d:g}=I(),d=B(),p=V(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:i.isDark?"#333335":"#ffffff",borderColor:i.isDark?"#333335":"#ffffff",textStyle:{color:i.isDark?"rgba(255, 255, 255, 0.7)":void 0},formatter:function(n){return g(n[0].data[0],"short")+":<br/>"+n.map(t=>`${t.marker} ${t.seriesName}: ${t.data[1]}`).join("<br>")}},backgroundColor:i.isDark?"rgba(0, 0, 0, 0.0)":void 0,...u.value})),u=B({legend:{data:[a("page.charts.sessionDayBucket.options.total"),a("page.charts.sessionDayBucket.options.incoming"),a("page.charts.sessionDayBucket.options.remoteRefuseTransferToClient"),a("page.charts.sessionDayBucket.options.remoteAcceptTransferToClient"),a("page.charts.sessionDayBucket.options.localRefuseTransferToPeer"),a("page.charts.sessionDayBucket.options.localAcceptTransferToPeer"),a("page.charts.sessionDayBucket.options.localNotInterested"),a("page.charts.sessionDayBucket.options.questionStatus"),a("page.charts.sessionDayBucket.options.optimisticUnchoke"),a("page.charts.sessionDayBucket.options.fromDHT"),a("page.charts.sessionDayBucket.options.fromPEX"),a("page.charts.sessionDayBucket.options.fromLSD"),a("page.charts.sessionDayBucket.options.fromTrackerOrOther"),a("page.charts.sessionDayBucket.options.rc4Encrypted"),a("page.charts.sessionDayBucket.options.plainTextEncrypted"),a("page.charts.sessionDayBucket.options.utpSocket"),a("page.charts.sessionDayBucket.options.tcpSocket")]},xAxis:{type:"time",max:"dataMax",min:"dataMin",minInterval:3600*24*1e3},grid:{left:"15%"},yAxis:{type:"value"},series:[{name:a("page.charts.sessionDayBucket.options.total"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.incoming"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.remoteRefuseTransferToClient"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.remoteAcceptTransferToClient"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.localRefuseTransferToPeer"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.localAcceptTransferToPeer"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.localNotInterested"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.questionStatus"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.optimisticUnchoke"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.fromDHT"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.fromPEX"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.fromLSD"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.fromTrackerOrOther"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.rc4Encrypted"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.plainTextEncrypted"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.utpSocket"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]},{name:a("page.charts.sessionDayBucket.options.tcpSocket"),type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:[]}]}),D=y;F(s,n=>{O(n.range[0],n.range[1],D.downloader)});const{loading:b,run:O,refresh:S,data:c}=M(He,{defaultParams:[s.range[0],s.range[1],D.downloader],onSuccess:n=>{n.data&&(u.value.series[0].data=n.data.map(t=>[new Date(t.key),t.totalConnections]),u.value.series[1].data=n.data.map(t=>[new Date(t.key),t.incomingConnections]),u.value.series[2].data=n.data.map(t=>[new Date(t.key),t.remoteRefuseTransferToClient]),u.value.series[3].data=n.data.map(t=>[new Date(t.key),t.remoteAcceptTransferToClient]),u.value.series[4].data=n.data.map(t=>[new Date(t.key),t.localRefuseTransferToPeer]),u.value.series[5].data=n.data.map(t=>[new Date(t.key),t.localAcceptTransferToPeer]),u.value.series[6].data=n.data.map(t=>[new Date(t.key),t.localNotInterested]),u.value.series[7].data=n.data.map(t=>[new Date(t.key),t.questionStatus]),u.value.series[8].data=n.data.map(t=>[new Date(t.key),t.optimisticUnchoke]),u.value.series[9].data=n.data.map(t=>[new Date(t.key),t.fromDHT]),u.value.series[10].data=n.data.map(t=>[new Date(t.key),t.fromPEX]),u.value.series[11].data=n.data.map(t=>[new Date(t.key),t.fromLSD]),u.value.series[12].data=n.data.map(t=>[new Date(t.key),t.fromTrackerOrOther]),u.value.series[13].data=n.data.map(t=>[new Date(t.key),t.rc4Encrypted]),u.value.series[14].data=n.data.map(t=>[new Date(t.key),t.plainTextEncrypted]),u.value.series[15].data=n.data.map(t=>[new Date(t.key),t.utpSocket]),u.value.series[16].data=n.data.map(t=>[new Date(t.key),t.tcpSocket]))},onError:n=>{d.value=n}});return(n,t)=>{const k=be,v=ke,x=le,T=Z,A=Y,C=j,P=W,U=Q,R=H;return _(),h(R,{hoverable:"",title:e(a)("page.charts.title.sessionDayBucket")},{extra:o(()=>[l(A,{model:s,"auto-label-width":""},{default:o(()=>[l(T,{field:"range",style:{"margin-bottom":"0"}},{label:o(()=>[m(f(e(a)("page.charts.options.days"))+" ",1),l(v,{content:e(a)("page.charts.tooltip.sessionDayBucket")},{default:o(()=>[l(k)]),_:1},8,["content"])]),default:o(()=>[l(x,{modelValue:s.range,"onUpdate:modelValue":t[0]||(t[0]=$=>s.range=$),"value-format":"Date",style:{width:"275px"},shortcuts:[{label:e(a)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1})]),_:1},8,["model"])]),default:o(()=>[d.value?(_(),h(P,{key:0,status:"500",title:e(a)("page.charts.error.title"),class:"chart chart-error"},{subtitle:o(()=>[m(f(d.value.message),1)]),extra:o(()=>[l(C,{type:"primary",onClick:t[1]||(t[1]=()=>{d.value=void 0,e(S)()})},{default:o(()=>[m(f(e(a)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):!e(b)&&(!e(c)?.data||e(c).data.length===0)?(_(),h(U,{key:1,class:"chart",style:{"align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}})):(_(),h(e(te),{key:2,class:"chart",option:p.value,loading:e(b),"loading-options":r.value,theme:e(i).isDark?"dark":"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),Ye=E({__name:"traffic",props:{downloader:{}},setup(y){ee([ae,ue,De,pe,ce,oe]);const s=K({range:[w().startOf("day").add(-14,"day").toDate(),new Date]}),i=G(),r=V(()=>({text:a("page.charts.loading"),color:i.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:i.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:i.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),{t:a,d:g}=I(),d=B(),p=V(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:i.isDark?"#333335":"#ffffff",borderColor:i.isDark?"#333335":"#ffffff",textStyle:{color:i.isDark?"rgba(255, 255, 255, 0.7)":void 0},formatter:function(n){return g(n[0].data[0],"short")+":<br/>"+n.map(t=>`${t.marker} ${t.seriesName}: ${fe(t.data[1])}`).join("<br>")}},backgroundColor:i.isDark?"rgba(0, 0, 0, 0.0)":void 0,...u.value})),u=B({legend:{data:[a("page.charts.traffic.options.download"),a("page.charts.traffic.options.upload")]},xAxis:{type:"time",max:"dataMax",min:"dataMin",minInterval:3600*24*1e3},grid:{left:"15%"},yAxis:{type:"value",axisLabel:{formatter:n=>fe(n)}},series:[{name:a("page.charts.traffic.options.download"),type:"line",emphasis:{focus:"series"},data:[]},{name:a("page.charts.traffic.options.upload"),type:"line",emphasis:{focus:"series"},data:[]}]});F(s,n=>{O(n.range[0],n.range[1],D.downloader)});const D=y,{loading:b,run:O,refresh:S,data:c}=M(Me,{defaultParams:[s.range[0],s.range[1],D.downloader],onSuccess:n=>{n.data&&(u.value.series[0].data=n.data.map(t=>[new Date(t.timestamp),t.dataOverallDownloaded]),u.value.series[1].data=n.data.map(t=>[new Date(t.timestamp),t.dataOverallUploaded]))},onError:n=>{d.value=n}});return(n,t)=>{const k=de,v=le,x=Z,T=Y,A=be,C=ke,P=re,U=j,R=W,$=Q,se=H;return _(),h(se,{hoverable:"",title:e(a)("page.charts.title.traffic")},{extra:o(()=>[l(P,null,{content:o(()=>[l(T,{model:s},{default:o(()=>[l(x,{field:"range",label:e(a)("page.charts.options.days"),"label-col-flex":"100px"},{default:o(()=>[l(v,{modelValue:s.range,"onUpdate:modelValue":t[0]||(t[0]=ne=>s.range=ne),"show-time":"","value-format":"Date",shortcuts:[{label:e(a)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(a)("page.charts.options.shortcut.30days"),value:()=>[e(w)().startOf("day").add(-30,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:o(()=>[l(k,null,{default:o(()=>[m(f(e(a)("page.charts.options.more")),1)]),_:1}),l(C,{content:e(a)("page.charts.tooltip.traffic")},{default:o(()=>[l(A)]),_:1},8,["content"])]),_:1})]),default:o(()=>[d.value?(_(),h(R,{key:0,status:"500",title:e(a)("page.charts.error.title"),class:"chart chart-error"},{subtitle:o(()=>[m(f(d.value.message),1)]),extra:o(()=>[l(U,{type:"primary",onClick:t[1]||(t[1]=()=>{d.value=void 0,e(S)()})},{default:o(()=>[m(f(e(a)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):!e(b)&&(!e(c)?.data||e(c).data.length===0)?(_(),h($,{key:1,class:"chart",style:{"align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}})):(_(),h(e(te),{key:2,class:"chart",option:p.value,loading:e(b),"loading-options":r.value,theme:e(i).isDark?"dark":"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),Ze=E({__name:"trends",props:{downloader:{}},setup(y){ee([pe,ae,ce,oe]);const{t:s}=I(),i=K({range:[w().startOf("day").add(-14,"day").toDate(),new Date]}),r=B(),a=G(),g=V(()=>({text:s("page.charts.loading"),color:a.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:a.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:a.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),d=V(()=>({tooltip:{trigger:"axis",backgroundColor:a.isDark?"#333335":"#ffffff",borderColor:a.isDark?"#333335":"#ffffff",textStyle:{color:a.isDark?"rgba(255, 255, 255, 0.7)":""}},backgroundColor:a.isDark?"rgba(0, 0, 0, 0.0)":void 0,...p.value})),p=B({xAxis:{type:"time",max:"dataMax"},yAxis:{type:"value"},series:[{data:[],type:"line",color:"#A5A051",areaStyle:{color:"#A5A051"},name:s("page.charts.trends.options.peers")},{data:[],type:"line",color:"#DB4D6D",areaStyle:{color:"#DB4D6D"},name:s("page.charts.trends.options.bans")}]});F(i,c=>{b(c.range[0],c.range[1],u.downloader)});const u=y,{loading:D,run:b,refresh:O,data:S}=M(Fe,{defaultParams:[i.range[0],i.range[1],u.downloader],onSuccess:c=>{c.data&&(p.value.series[0].data=c.data.connectedPeersTrend.sort((n,t)=>n.key-t.key).map(n=>[new Date(n.key),n.value]),p.value.series[1].data=c.data.bannedPeersTrend.sort((n,t)=>n.key-t.key).map(n=>[new Date(n.key),n.value]))},onError:c=>{r.value=c}});return(c,n)=>{const t=le,k=Z,v=Y,x=j,T=W,A=Q,C=H;return _(),h(C,{hoverable:"",title:e(s)("page.charts.title.trends")},{extra:o(()=>[l(v,{model:i,"auto-label-width":""},{default:o(()=>[l(k,{field:"range",label:e(s)("page.charts.options.days"),style:{"margin-bottom":"0"}},{default:o(()=>[l(t,{modelValue:i.range,"onUpdate:modelValue":n[0]||(n[0]=P=>i.range=P),"value-format":"Date",style:{width:"275px"},shortcuts:[{label:e(s)("page.charts.options.shortcut.7days"),value:()=>[e(w)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(s)("page.charts.options.shortcut.14days"),value:()=>[e(w)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(s)("page.charts.options.shortcut.30days"),value:()=>[e(w)().startOf("day").add(-30,"day").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:o(()=>[r.value?(_(),h(T,{key:0,status:"500",title:e(s)("page.charts.error.title"),class:"chart chart-error"},{subtitle:o(()=>[m(f(r.value.message),1)]),extra:o(()=>[l(x,{type:"primary",onClick:n[1]||(n[1]=()=>{r.value=void 0,e(O)()})},{default:o(()=>[m(f(e(s)("page.charts.error.refresh")),1)]),_:1})]),_:1},8,["title"])):!e(D)&&(!e(S)?.data||e(S).data.connectedPeersTrend.length===0&&e(S).data.bannedPeersTrend.length===0)?(_(),h(A,{key:1,class:"chart",style:{"align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}})):(_(),h(e(te),{key:2,class:"chart",option:d.value,loading:e(D),"loading-options":g.value,theme:e(a).isDark?"dark":"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loading-options","theme"]))]),_:1},8,["title"])}}}),et=E({__name:"grid",props:{downloader:{},showCharts:{}},setup(y){const{t:s}=I(),i=y,r=V(()=>i.downloader==="all"?void 0:i.downloader);return(a,g)=>{const d=Ue,p=Ae;return _(),h(p,{justify:"center",align:"stretch",wrap:!0,gutter:[{xs:12,sm:12,md:12,lg:12,xl:24},{xs:12,sm:12,md:12,lg:12,xl:24}]},{default:o(()=>[y.showCharts.banTrends?(_(),h(d,{key:0,xl:12,lg:24,md:24,sm:24,xs:24},{default:o(()=>[l(We,{downloader:r.value},null,8,["downloader"])]),_:1})):N("",!0),y.showCharts.fieldPie?(_(),h(d,{key:1,xl:12,lg:24,md:24,sm:24,xs:24},{default:o(()=>[l(Xe,{downloader:r.value},null,8,["downloader"])]),_:1})):N("",!0),y.showCharts.ispPie?(_(),h(d,{key:2,xl:12,lg:24,md:24,sm:24,xs:24},{default:o(()=>[l(ie,{title:e(s)("page.charts.title.geoip")},{default:o(()=>[l(Je,{downloader:r.value},null,8,["downloader"])]),_:1},8,["title"])]),_:1})):N("",!0),y.showCharts.traffic?(_(),h(d,{key:3,xl:12,lg:24,md:24,sm:24,xs:24},{default:o(()=>[l(ie,{title:e(s)("page.charts.title.traffic")},{default:o(()=>[l(Ye,{downloader:r.value},null,8,["downloader"])]),_:1},8,["title"])]),_:1})):N("",!0),y.showCharts.trends?(_(),h(d,{key:4,xl:24,lg:24,md:24,sm:24,xs:24},{default:o(()=>[l(ie,{title:e(s)("page.charts.title.trends")},{default:o(()=>[l(Ze,{downloader:r.value},null,8,["downloader"])]),_:1},8,["title"])]),_:1})):N("",!0),y.showCharts.sessionDayBucket?(_(),h(d,{key:5,xl:24,lg:24,md:24,sm:24,xs:24},{default:o(()=>[l(ie,{title:e(s)("page.charts.title.sessionDayBucket")},{default:o(()=>[l(Qe,{downloader:r.value},null,8,["downloader"])]),_:1},8,["title"])]),_:1})):N("",!0)]),_:1})}}}),it=E({__name:"index",setup(y){const{t:s}=I(),i=je(),r=B(i.showCharts),{data:a}=M(Se);F(r,()=>{i.setShowCharts(r.value)});const g=V(()=>[{id:"all",title:s("page.charts.all")},...a.value?.data.map(d=>({id:d.id,title:d.name}))??[]]);return(d,p)=>{const u=Le,D=j,b=Ee,O=me,S=re,c=Ie,n=Re;return _(),h(n,{"default-active-key":0,"lazy-load":"",animation:"",type:"rounded"},{extra:o(()=>[l(S,{position:"bottom"},{content:o(()=>[l(O,{direction:"vertical"},{default:o(()=>[l(b,{modelValue:r.value.banTrends,"onUpdate:modelValue":p[0]||(p[0]=t=>r.value.banTrends=t)},{default:o(()=>[m(f(e(s)("page.charts.title.line")),1)]),_:1},8,["modelValue"]),l(b,{modelValue:r.value.fieldPie,"onUpdate:modelValue":p[1]||(p[1]=t=>r.value.fieldPie=t)},{default:o(()=>[m(f(e(s)("page.charts.title.fieldPie")),1)]),_:1},8,["modelValue"]),l(b,{modelValue:r.value.ispPie,"onUpdate:modelValue":p[2]||(p[2]=t=>r.value.ispPie=t)},{default:o(()=>[m(f(e(s)("page.charts.title.geoip")),1)]),_:1},8,["modelValue"]),l(b,{modelValue:r.value.traffic,"onUpdate:modelValue":p[3]||(p[3]=t=>r.value.traffic=t)},{default:o(()=>[m(f(e(s)("page.charts.title.traffic")),1)]),_:1},8,["modelValue"]),l(b,{modelValue:r.value.trends,"onUpdate:modelValue":p[4]||(p[4]=t=>r.value.trends=t)},{default:o(()=>[m(f(e(s)("page.charts.title.trends")),1)]),_:1},8,["modelValue"]),l(b,{modelValue:r.value.sessionDayBucket,"onUpdate:modelValue":p[5]||(p[5]=t=>r.value.sessionDayBucket=t)},{default:o(()=>[m(f(e(s)("page.charts.title.sessionDayBucket")),1)]),_:1},8,["modelValue"])]),_:1})]),default:o(()=>[l(D,null,{icon:o(()=>[l(u)]),default:o(()=>[m(f(e(s)("page.charts.options")),1)]),_:1})]),_:1})]),default:o(()=>[(_(!0),Oe(Pe,null,Be(g.value,(t,k)=>(_(),h(c,{key:k,title:t.title},{default:o(()=>[l(et,{downloader:t.id,"show-charts":r.value},null,8,["downloader","show-charts"])]),_:2},1032,["title"]))),128))]),_:1})}}});export{it as default};
