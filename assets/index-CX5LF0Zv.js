import{u as x,a as M,g as Q,I as W,b as X,c as Y,f as S,d as Z,e as ee,_ as T}from"./index-DgfpHrne.js";import{_ as te}from"./queryIpLink.vue_vue_type_script_setup_true_lang-UXcGrBiH.js";import{f as P,a as ae,a8 as N,aa as ne,w as y,c as w,s as A,a9 as o,t,y as a,m as I,x as r,v as c,k as C}from"./libs-CGCN05bf.js";import{v as oe,e as se,S as D,T as $,N as re,a8 as le}from"./arcoDesign-oXuB2kqy.js";import{I as ie}from"./index-C2gOs6jd.js";import"./uuid-BMzgKRou.js";async function ce(i){const s=x();await s.serverAvailable;const l=new URL(M(s.endpoint,"api/bans/logs"),location.href);return l.searchParams.set("page",String(i.page)),i.pageSize&&l.searchParams.set("pageSize",String(i.pageSize)),i.sorter&&l.searchParams.set("orderBy",i.sorter),fetch(l,{headers:Q()}).then(n=>(s.assertResponseLogin(n),n.json()))}const pe=P({__name:"banlogTable",setup(i){const s=ae(!0),l=x(),{t:n,d:g}=N(),{data:b,total:U,current:u,loading:k,pageSize:_,changeCurrent:B,changePageSize:H,refresh:K,run:z}=ne(ce,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:p=>`${l.endpoint}-banlogs-${p?.[0].page||1}-${p?.[0].pageSize||10}`,onAfter:()=>{s.value=!1}},[ee]);y([_,u],()=>{s.value=!0}),y(()=>l.endpoint,K);const L=w(()=>s.value||k.value||!v.value),F=[{title:()=>n("page.banlog.banlogTable.column.banTime")+"/"+n("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",dataIndex:"banAt",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:210},{title:()=>n("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",dataIndex:"peerIp",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:230},{title:()=>n("page.banlog.banlogTable.column.peerId"),slotName:"peerId",dataIndex:"peerId",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:120},{title:()=>n("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",dataIndex:"peerUploaded",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:150},{title:()=>n("page.banlog.banlogTable.column.torrentName"),dataIndex:"torrentName",slotName:"torrentName",sortable:{sortDirections:["ascend","descend"],sorter:!0},ellipsis:!0,tooltip:!0},{title:()=>n("page.banlog.banlogTable.column.torrentSize"),slotName:"torrentSize",dataIndex:"torrentSize",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:120},{title:()=>n("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],v=w(()=>b.value?.data.results),V=(p,f)=>{z(f?{page:u.value,pageSize:_.value,sorter:`${p}|${f}`}:{page:u.value,pageSize:_.value})};return(p,f)=>{const j=ie,d=$,R=le,h=D,E=X,J=Y,O=re,m=se,q=W,G=oe;return C(),A(G,{stripe:!0,columns:F,data:v.value,loading:L.value,pagination:{total:o(U),current:o(u),pageSize:o(_),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onSorterChange:V,onPageChange:o(B),onPageSizeChange:o(H)},{banAt:t(({record:e})=>[a(h,{fill:"",direction:"vertical"},{default:t(()=>[a(d,null,{default:t(()=>[a(j),c(" "+r(o(g)(e.banAt,"long")),1)]),_:2},1024),a(d,null,{default:t(()=>[a(R),c(" "+r(e.unbanAt?o(g)(e.unbanAt,"long"):o(n)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:t(({record:e})=>[a(d,{copyable:"",code:""},{default:t(()=>[a(te,{ip:e.peerIp,style:{color:"var(--color-text-2)"}},{default:t(()=>[c(r(o(Z)(e.peerIp,e.peerPort)),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:t(({record:e})=>[a(h,{fill:"",style:{"justify-content":"space-between"}},{default:t(()=>[a(h,{fill:"",direction:"vertical"},{default:t(()=>[a(d,null,{default:t(()=>[a(E,{class:"green"}),c(" "+r(o(S)(e.peerUploaded)),1)]),_:2},1024),a(d,null,{default:t(()=>[a(J,{class:"red"}),c(" "+r(o(S)(e.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),a(m,{content:(e.peerProgress*100).toFixed(2)+"%"},{default:t(()=>[a(O,{percent:e.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:t(({record:e})=>[I("p",null,[c(r(e.peerId?e.peerId:o(n)("page.banlist.banlist.listItem.empty"))+" ",1),a(m,{content:e.peerClientName?e.peerClientName:o(n)("page.banlist.banlist.listItem.empty")},{default:t(()=>[a(q)]),_:1},8,["content"])])]),torrentName:t(({record:e})=>[a(m,{content:o(n)("page.banlog.banlogTable.column.torrentName.tooltip",{downloader:e.downloader?.name,hash:e.torrentInfoHash})},{default:t(()=>[I("p",null,r(e.torrentName),1)]),_:2},1032,["content"])]),torrentSize:t(({record:e})=>[a(m,{content:`Hash: ${e.torrentInfoHash}`},{default:t(()=>[I("p",null,r(o(S)(e.torrentSize)),1)]),_:2},1032,["content"])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])}}}),de=T(pe,[["__scopeId","data-v-47522e89"]]),ge=P({__name:"index",setup(i){const{t:s}=N();return(l,n)=>{const g=$,b=D;return C(),A(b,{direction:"vertical",fill:""},{default:t(()=>[a(g,{style:{"font-size":"1.2em"}},{default:t(()=>[c(r(o(s)("page.banlog.description")),1)]),_:1}),a(de)]),_:1})}}}),Se=T(ge,[["__scopeId","data-v-e1fde76f"]]);export{Se as default};
