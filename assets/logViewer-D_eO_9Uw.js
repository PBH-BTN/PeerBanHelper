import{E as M,F as q,a as B,u as W,g as Q,h as K,_ as X}from"./index-BzjiyctC.js";import{f as F,a7 as $,s as _,k as p,t,y as o,m as D,n as Y,a3 as h,a as v,r as Z,c as L,a9 as ee,I as te,u as A,j as oe,F as ae,P as se,v as R,x as b}from"./libs-BYIN-Nlk.js";import{y as le,aN as ne,e as re,G as ce,H as ie,v as ue,S as de,c as pe,J as fe,n as he,m as _e,R as me,Q as ge,T as we,M as I}from"./arcoDesign-CWLifbdQ.js";import"./uuid-5hg4BtTT.js";var u=(r=>(r.DEBUG="DEBUG",r.INFO="INFO",r.WARN="WARN",r.ERROR="ERROR",r.TRACE="TRACE",r))(u||{});const ye=["onClick"],ve=F({__name:"copier",props:{text:{}},setup(r){const{t:n}=$(),d=async()=>{q(r.text),await new Promise(c=>setTimeout(c,3e3))};return(c,e)=>{const f=le,w=ne,i=re;return p(),_(M,{once:"","async-fn":d},{default:t(({run:k,loading:m})=>[o(i,{content:h(n)(m?"copier.copied":"copier.copy")},{default:t(()=>[D("span",{class:Y(m?"arco-typography-operation-copied":"arco-typography-operation-copy"),onClick:k},[m?(p(),_(f,{key:0})):(p(),_(w,{key:1}))],10,ye)]),_:2},1032,["content"])]),_:1})}}});class Re{_isOpen=!1;get isOpen(){return this._isOpen}get State(){return this.ws?.readyState??WebSocket.CLOSED}ws;url;constructor(n,d,c){const e=new URL(n);this.url=new URL(B(`${e.protocol==="https:"?"wss":"ws"}://${e.host}${e.pathname}`,d)),this.url.searchParams.append("token",c)}open(n,d,c){try{this.ws?.close(),this.url.searchParams.append("offset",n.toString()),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this._isOpen=!0},this.ws.onerror=e=>{c(new Error(`WebSocket error: ${e}`))},this.ws.onclose=()=>{this._isOpen=!1},this.ws.onmessage=e=>{try{const f=JSON.parse(e.data);f.success?d(f.data):c(new Error(`WebSocket error: ${f.message}`))}catch{}}}catch(e){return e instanceof Error&&c(e),!1}return!0}close(){this._isOpen&&(this.ws?.close(),this.ws=void 0)}}class be extends Re{constructor(){const n=W();super(n.endpoint,"api/logs/stream",n.authToken)}}async function xe(){const r=W();await r.serverAvailable;const n=new URL(B(r.endpoint,"api/logs/history"),location.href);return fetch(n,{headers:Q()}).then(d=>(r.assertResponseLogin(d),d.json()))}const Se={class:"hover-display-btn"},ke=F({__name:"logViewer",setup(r){const{t:n,d}=$(),c=v(!0),e=Z({hideThreads:[],autoScroll:!0,autoRefresh:!1,showLevel:{[u.TRACE]:!1,[u.DEBUG]:!1,[u.INFO]:!0,[u.WARN]:!0,[u.ERROR]:!0}}),f=L(()=>Array.from(w.value).map(s=>({value:s,tagProps:{color:O(s)}}))),w=v(new Set),i=v([]);ee(xe,{onSuccess:s=>{i.value.splice(0,i.value.length),i.value.push(...s.data),c.value=!1,s.data.forEach(l=>w.value.add(l.thread))}});const k=L(()=>i.value.filter(s=>e.showLevel[s.level]).filter(s=>!e.hideThreads.includes(s.thread))),m=v(),T=new be,G=async s=>{try{return s?T.open(i.value.length>0?i.value[i.value.length-1].offset:0,l=>{i.value.push(l),w.value.add(l.thread),e.autoScroll&&m.value?.scrollIntoView({index:i.value.length-1,align:"bottom"})},l=>{I.error(l.message),e.autoRefresh=!1}):(T.close(),!0)}catch(l){return l instanceof Error&&I.error(l.message),!1}},C=s=>{switch(s){case u.TRACE:return"blue";case u.WARN:return"orange";case u.ERROR:return"red";case u.DEBUG:case u.INFO:default:return"gray"}},O=s=>s.startsWith("virtual-")||s.startsWith("pool")||/Thread-[0-9]+/.test(s)?"gray":K(s,["orange","orangered","red","blue"]);te(()=>{T.close()});const x=v(!1);return(s,l)=>{const E=ue,y=ie,S=pe,N=de,j=fe,P=ce,g=ge,H=we,U=me,z=_e,J=he;return p(),_(N,{direction:"vertical",class:"container",size:"medium"},{default:t(()=>[o(P,{disabled:c.value,model:e,layout:"inline"},{default:t(()=>[o(y,{field:"autoRefresh",label:h(n)("page.settings.tab.info.log.enableAutoRefresh")},{default:t(()=>[o(E,{modelValue:e.autoRefresh,"onUpdate:modelValue":l[0]||(l[0]=a=>e.autoRefresh=a),"before-change":G},null,8,["modelValue"])]),_:1},8,["label"]),e.autoRefresh?(p(),_(y,{key:0,field:"autoScroll",label:h(n)("page.settings.tab.info.log.autoScorll")},{default:t(()=>[o(E,{modelValue:e.autoScroll,"onUpdate:modelValue":l[1]||(l[1]=a=>e.autoScroll=a)},null,8,["modelValue"])]),_:1},8,["label"])):A("",!0),o(y,{field:"showThreadName",label:h(n)("page.settings.tab.info.log.showThread")},{default:t(()=>[o(E,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=a=>x.value=a)},null,8,["modelValue"])]),_:1},8,["label"]),o(y,{field:"showLevel",label:h(n)("page.settings.tab.info.log.showLevel")},{default:t(()=>[o(N,null,{default:t(()=>[(p(!0),oe(ae,null,se(Object.keys(e.showLevel),a=>(p(),_(S,{key:a,checked:e.showLevel[a],"onUpdate:checked":V=>e.showLevel[a]=V,color:C(a),checkable:""},{default:t(()=>[R(b(a),1)]),_:2},1032,["checked","onUpdate:checked","color"]))),128))]),_:1})]),_:1},8,["label"]),o(y,{field:"hideThreads",label:h(n)("page.settings.tab.info.log.hideThreads")},{default:t(()=>[o(j,{modelValue:e.hideThreads,"onUpdate:modelValue":l[3]||(l[3]=a=>e.hideThreads=a),placeholder:h(n)("page.settings.tab.info.log.hideThreads.placeholder"),style:{width:"15rem"},multiple:"","max-tag-count":1,"allow-create":"",scrollbar:"",options:f.value},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["disabled","model"]),o(J,{ref_key:"logList",ref:m,size:"small",loading:c.value,scrollbar:"","virtual-list-props":{height:650,buffer:50},data:k.value},{item:t(({item:a,index:V})=>[(p(),_(z,{key:V},{default:t(()=>[o(U,{class:"log-line-container",justify:"end",wrap:!1},{default:t(()=>[o(g,{flex:"auto"},{default:t(()=>[o(U,{class:"log-line",wrap:!1,justify:"start",gutter:10},{default:t(()=>[o(g,{flex:"24px"},{default:t(()=>[o(S,{class:"level-tag",color:C(a.level)},{default:t(()=>[R(b(a.level),1)]),_:2},1032,["color"])]),_:2},1024),o(g,{flex:"120px"},{default:t(()=>[o(S,null,{default:t(()=>[R(b(h(d)(a.time,"log")),1)]),_:2},1024)]),_:2},1024),x.value?(p(),_(g,{key:0,flex:"1"},{default:t(()=>[o(S,{color:O(a.thread)},{default:t(()=>[R(b(a.thread),1)]),_:2},1032,["color"])]),_:2},1024)):A("",!0),o(g,{flex:x.value?8:9,claass:"log-line"},{default:t(()=>[o(H,{style:{flex:"1",width:"100%"},ellipsis:{rows:1,showTooltip:!0}},{default:t(()=>[R(b(a.content),1)]),_:2},1024)]),_:2},1032,["flex"])]),_:2},1024)]),_:2},1024),o(g,{flex:"20px"},{default:t(()=>[D("div",Se,[o(ve,{text:a.content},null,8,["text"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:1},8,["loading","data"])]),_:1})}}}),Oe=X(ke,[["__scopeId","data-v-8b330223"]]);export{Oe as default};
