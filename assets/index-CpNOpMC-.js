import{u as O,b as oe,c as se,I as j,f as k,h as de,_ as Z,d as _e,l as ge,i as me,e as fe}from"./index-B35Mpysw.js";import{f as q,a7 as J,a as L,a8 as ee,s as v,k as d,t as e,y as t,v as i,x as s,a3 as a,a1 as W,m as X,u as be,j as Y,F as le,P as he,q as ie,c as V,w as ne}from"./libs-Dj0SilfQ.js";import{G as ye,a as ve,b as Se}from"./data-D9kz8a5r.js";import{_ as ce}from"./queryIpLink.vue_vue_type_script_setup_true_lang-Btp7HT0p.js";import{G as re,S as G,T as Q,v as te,e as ae,c as ze,E as we,aa as Ie,N as Ce,a7 as Le,j as He,f as xe,at as Pe}from"./arcoDesign-R_OFWu-B.js";import{I as pe}from"./index-B1LheQGp.js";import{I as ke}from"./index-DESYekPG.js";import"./uuid-BMzgKRou.js";const $e=q({__name:"accessHistoryModal",setup(R,{expose:S}){const{t:p,d:l}=J(),H=O(),_=L(!1),f=L(""),x=L("");S({showModal:(c,r)=>{x.value=r,f.value=c,h({page:1,pageSize:10,infoHash:c}),_.value=!0}});const{data:z,total:$,current:w,loading:N,pageSize:b,changeCurrent:F,changePageSize:D,runAsync:h}=ee(ye,{pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},manual:!0,cacheKey:c=>`${H.endpoint}-torrentAccessHistory-${c?.[0].infoHash}-${c?.[0].page||1}-${c?.[0].pageSize||10}`}),T=[{title:()=>p("page.torrentList.accessHistory.column.downloader"),slotName:"downloader"},{title:()=>p("page.torrentList.accessHistory.column.address"),slotName:"address"},{title:"Peer ID",slotName:"peerId"},{title:()=>p("page.torrentList.accessHistory.column.traffic"),slotName:"traffic",dataIndex:"uploaded",sortable:{sortDirections:["ascend","descend"],sorter:!0}},{title:()=>W(G,[p("page.torrentList.accessHistory.column.offset"),W(Ie,{content:p("page.torrentList.accessHistory.column.offsetDescription")},()=>W(j))]),slotName:"offset"},{title:"Flags",slotName:"flags"},{title:()=>p("page.torrentList.accessHistory.column.timeseen"),slotName:"time"}],A=c=>c.split(" ").map(r=>r+" - "+p("page.dashboard.peerList.column.flags."+r.trim())),y=(c,r)=>{h(r?{page:w.value,pageSize:b.value,infoHash:f.value,sorter:`${c}|${r}`}:{page:w.value,pageSize:b.value,infoHash:f.value})};return(c,r)=>{const I=ie("i18n-t"),u=Q,U=ze,C=ae,g=oe,P=se,m=G,E=te,M=we,K=re;return d(),v(K,{visible:_.value,"onUpdate:visible":r[0]||(r[0]=o=>_.value=o),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(I,{keypath:"page.torrentList.accessHistory.title"},{name:e(()=>[i(s(x.value),1)]),_:1})]),default:e(()=>[t(m,{direction:"vertical",fill:""},{default:e(()=>[t(u,{style:{"font-size":"1.2em"}},{default:e(()=>[i(s(a(p)("page.torrentList.accessHistory.description")),1)]),_:1}),a(z)?.data.results||a(N)?(d(),v(E,{key:0,stripe:!0,columns:T,data:a(z)?.data.results,loading:a(N),pagination:{total:a($),current:a(w),pageSize:a(b),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:a(F),onSorterChange:y,onPageSizeChange:a(D)},{address:e(({record:o})=>[t(u,{code:"",copyable:"",style:{"white-space":"nowrap"}},{default:e(()=>[t(ce,{ip:o.address,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(s(o.address),1)]),_:2},1032,["ip"])]),_:2},1024)]),downloader:e(({record:o})=>[t(U,{color:a(de)(o.downloader.id)},{default:e(()=>[i(s(o.downloader.name),1)]),_:2},1032,["color"])]),peerId:e(({record:o})=>[X("p",null,[i(s(o.peerId?o.peerId:a(p)("page.banlist.banlist.listItem.empty"))+" ",1),t(C,{content:o.clientName?o.clientName:a(p)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(a(j))]),_:1},8,["content"])])]),traffic:e(({record:o})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(g,{class:"green"}),i(" "+s(a(k)(o.uploaded)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(P,{class:"red"}),i(" "+s(a(k)(o.downloaded)),1)]),_:2},1024)]),_:2},1024)]),offset:e(({record:o})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(g,{class:"green"}),i(" "+s(a(k)(o.uploadedOffset)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(P,{class:"red"}),i(" "+s(a(k)(o.downloadedOffset)),1)]),_:2},1024)]),_:2},1024)]),flags:e(({record:o})=>[X("p",null,[i(s(o.lastFlags)+" ",1),o.lastFlags?(d(),v(C,{key:0},{content:e(()=>[(d(!0),Y(le,null,he(A(o.lastFlags),B=>(d(),Y("p",{key:B},s(B),1))),128))]),default:e(()=>[t(a(j))]),_:2},1024)):be("",!0)])]),time:e(({record:o})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[i(s(a(p)("page.torrentList.accessHistory.column.timeseen.first"))+": "+s(a(l)(o.firstTimeSeen,"long")),1)]),_:2},1024),t(u,null,{default:e(()=>[i(s(a(p)("page.torrentList.accessHistory.column.timeseen.last"))+": "+s(a(l)(o.lastTimeSeen,"long")),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])):(d(),v(M,{key:1,style:{height:"20vh","align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}},{default:e(()=>[i(s(a(p)("page.torrentList.accessHistory.empty")),1)]),_:1}))]),_:1})]),_:1},8,["visible"])}}}),Ne=Z($e,[["__scopeId","data-v-f8b10164"]]),Te=q({__name:"banHistoryModal",setup(R,{expose:S}){const p=O(),{t:l,d:H}=J(),_=L(!1),f=L(""),x=L("");S({showModal:(c,r)=>{f.value=r,x.value=c,h({page:1,pageSize:10,infoHash:c}),_.value=!0}});const{data:z,total:$,current:w,loading:N,pageSize:b,changeCurrent:F,changePageSize:D,runAsync:h}=ee(ve,{manual:!0,pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:c=>`${p.endpoint}-torrentBanHistory-${c?.[0].infoHash}-${c?.[0].page||1}-${c?.[0].pageSize||10}`}),T=[{title:()=>l("page.banlog.banlogTable.column.banTime")+"/"+l("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",width:210},{title:()=>l("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",width:200},{title:()=>l("page.banlog.banlogTable.column.peerId"),slotName:"peerId",width:120},{title:()=>l("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",dataIndex:"peerUploaded",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:150},{title:()=>l("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],A=(c,r)=>{h(r?{page:w.value,pageSize:b.value,infoHash:x.value,sorter:`${c}|${r}`}:{page:w.value,pageSize:b.value,infoHash:x.value})},y=V(()=>z.value?.data.results);return(c,r)=>{const I=ie("i18n-t"),u=Q,U=pe,C=Le,g=G,P=oe,m=se,E=Ce,M=ae,K=j,o=te,B=re;return d(),v(B,{visible:_.value,"onUpdate:visible":r[0]||(r[0]=n=>_.value=n),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(I,{keypath:"page.torrentList.banHistory.title"},{name:e(()=>[i(s(f.value),1)]),_:1})]),default:e(()=>[t(g,{direction:"vertical",fill:"",style:{"max-width":"1400px"}},{default:e(()=>[t(u,{style:{"font-size":"1.2em"}},{default:e(()=>[i(s(a(l)("page.torrentList.banHistory.description")),1)]),_:1}),t(o,{stripe:!0,columns:T,data:y.value,loading:a(N),pagination:{total:a($),current:a(w),pageSize:a(b),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",onPageChange:a(F),onSorterChange:A,onPageSizeChange:a(D)},{banAt:e(({record:n})=>[t(g,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(U),i(" "+s(a(H)(n.banAt,"long")),1)]),_:2},1024),t(u,null,{default:e(()=>[t(C),i(" "+s(n.unbanAt?a(H)(n.unbanAt,"long"):a(l)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:e(({record:n})=>[t(u,{code:""},{default:e(()=>[t(ce,{ip:n.peerIp,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(s(a(_e)(n.peerIp,n.peerPort)),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:e(({record:n})=>[t(g,{fill:"",style:{"justify-content":"space-between"}},{default:e(()=>[t(g,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(P,{class:"green"}),i(" "+s(a(k)(n.peerUploaded)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(m,{class:"red"}),i(" "+s(a(k)(n.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),t(M,{content:(n.peerProgress*100).toFixed(2)+"%"},{default:e(()=>[t(E,{percent:n.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:e(({record:n})=>[X("p",null,[i(s(n.peerId?n.peerId:a(l)("page.banlist.banlist.listItem.empty"))+" ",1),t(M,{content:n.peerClientName?n.peerClientName:a(l)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(K)]),_:1},8,["content"])])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1})]),_:1},8,["visible"])}}}),Ae=Z(Te,[["__scopeId","data-v-99974867"]]),Me=q({__name:"torrentTable",setup(R){const S=L(!0),p=O(),{t:l}=J(),{data:H,total:_,current:f,loading:x,pageSize:z,changeCurrent:$,changePageSize:w,refresh:N,run:b}=ee(Se,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:I=>`${p.endpoint}-torrentInfoList-${I?.[0].page||1}-${I?.[0].pageSize||10}`,onAfter:()=>{S.value=!1}},[fe]);ne([z,f],()=>{S.value=!0}),ne(()=>p.endpoint,N);const F=V(()=>S.value||x.value||!h.value),D=[{title:()=>l("page.torrentList.column.name"),dataIndex:"name",ellipsis:!0,tooltip:!0,width:500},{title:"Hash",slotName:"hash",width:340},{title:()=>l("page.torrentList.column.size"),slotName:"size",width:120},{title:()=>l("page.torrentList.column.count"),slotName:"count"},{title:()=>l("page.torrentList.column.actions"),slotName:"action"}],h=V(()=>H.value?.data.results),T=L(),A=L(),y=V(()=>r.plusStatus?.enabledFeatures?.includes("basic")),c=ge.debounce(I=>{$(1),b({page:1,pageSize:z.value,keyword:I})},300),r=O();return(I,u)=>{const U=He,C=G,g=Q,P=pe,m=ae,E=Pe,M=me,K=ke,o=xe,B=te;return d(),Y(le,null,[t(C,{direction:"vertical",fill:""},{default:e(()=>[t(C,{class:"align-right",fill:""},{default:e(()=>[t(U,{style:{width:"250px"},placeholder:a(l)("page.torrentList.accessHistory.searchPlaceholder"),"allow-clear":"","search-button":"",onSearch:a(c),onChange:a(c),onClear:u[0]||(u[0]=n=>a(b)({page:a(f),pageSize:a(z)}))},null,8,["placeholder","onSearch","onChange"])]),_:1}),t(B,{stripe:!0,columns:D,data:h.value,loading:F.value,pagination:{total:a(_),current:a(f),pageSize:a(z),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:a($),onPageSizeChange:a(w)},{size:e(({record:n})=>[i(s(a(k)(n.size)),1)]),hash:e(({record:n})=>[t(g,{code:"",style:{"white-space":"nowrap"}},{default:e(()=>[i(s(n.infoHash),1)]),_:2},1024)]),count:e(({record:n})=>[t(C,{fill:"",direction:"vertical"},{default:e(()=>[t(m,{content:`${a(l)("page.torrentList.column.count.ban")}: ${n.peerBanCount}`},{default:e(()=>[t(g,null,{default:e(()=>[t(P),i(" "+s(n.peerBanCount),1)]),_:2},1024)]),_:2},1032,["content"]),t(m,{content:`${a(l)("page.torrentList.column.count.access")}: ${n.peerAccessCount}`},{default:e(()=>[t(g,null,{default:e(()=>[t(E),i(" "+s(n.peerAccessCount),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),action:e(({record:n})=>[t(C,{wrap:""},{default:e(()=>[t(m,{content:y.value?a(l)("page.torrentList.column.actions.history"):a(l)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>[t(o,{class:"edit-btn",shape:"circle",type:"text",disabled:!y.value,onClick:ue=>T.value?.showModal(n.infoHash,n.name)},{icon:e(()=>[y.value?(d(),v(M,{key:0})):(d(),v(K,{key:1}))]),_:1},8,["disabled","onClick"])]),_:2},1032,["content"]),t(m,{content:y.value?a(l)("page.torrentList.column.actions.ban"):a(l)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>[t(o,{class:"edit-btn",shape:"circle",type:"text",disabled:!y.value,onClick:ue=>A.value?.showModal(n.infoHash,n.name)},{icon:e(()=>[y.value?(d(),v(P,{key:0})):(d(),v(K,{key:1}))]),_:1},8,["disabled","onClick"])]),_:2},1032,["content"])]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1}),t(Ne,{ref_key:"accessHistoryModal",ref:T},null,512),t(Ae,{ref_key:"banHistoryModal",ref:A},null,512)],64)}}}),Ke=Z(Me,[["__scopeId","data-v-a74cb7bd"]]),Oe=q({__name:"index",setup(R){const{t:S}=J();return(p,l)=>{const H=Q,_=G;return d(),v(_,{direction:"vertical",fill:""},{default:e(()=>[t(H,{style:{"font-size":"1.2em"}},{default:e(()=>[i(s(a(S)("page.torrentList.description")),1)]),_:1}),t(Ke)]),_:1})}}});export{Oe as default};
