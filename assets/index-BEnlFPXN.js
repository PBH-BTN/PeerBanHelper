import{u as Q,e as me,c as O,f as x,I as re,b as pe,_ as ne,l as ye,h as be,d as he}from"./index-4-creqW-.js";import{f as R,a6 as W,r as k,aj as ae,q as ue,j as _,s as y,t as e,y as t,v as i,x as l,a2 as n,p as ee,k as te,P as ve,F as de,u as Se,a1 as Z,c as J,w as ce}from"./libs-AHWYfG3N.js";import{G as ze,a as we,b as Le}from"./data-DaI740tW.js";import{_ as _e}from"./queryIpLink.vue_vue_type_script_setup_true_lang-DIaVxAsj.js";import{a9 as Ie,S as V,T as X,b as Ce,c as oe,t as le,E as He,J as ge,a6 as xe,K as ke,j as Pe,aq as Ne,B as Te}from"./arcoDesign-Bjphlx8G.js";import{I as fe}from"./index-wv47t0QX.js";import{I as $e}from"./index-DgQ00YEp.js";const Ae=R({__name:"accessHistoryModal",setup(Y,{expose:b}){const{t:r,d:s}=W(),z=Q(),g=k(!1),f=k("");b({showModal:(o,u)=>{f.value=u,U({page:1,pageSize:10,infoHash:o}),g.value=!0}});const{data:P,total:w,current:M,loading:N,pageSize:B,changeCurrent:T,changePageSize:F,runAsync:U}=ae(ze,{pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},manual:!0,cacheKey:o=>`${z.endpoint}-torrentAccessHistory-${o==null?void 0:o[0].infoHash}-${(o==null?void 0:o[0].page)||1}-${(o==null?void 0:o[0].pageSize)||10}`}),$=[{title:()=>r("page.torrentList.accessHistory.column.downloader"),slotName:"downloader"},{title:()=>r("page.torrentList.accessHistory.column.address"),slotName:"address"},{title:"Peer ID",slotName:"peerId"},{title:()=>r("page.torrentList.accessHistory.column.traffic"),slotName:"traffic"},{title:()=>Z(V,[r("page.torrentList.accessHistory.column.offset"),Z(Ie,{content:r("page.torrentList.accessHistory.column.offsetDescription")},()=>Z(O))]),slotName:"offset"},{title:"Flags",slotName:"flags"},{title:()=>r("page.torrentList.accessHistory.column.timeseen"),slotName:"time"}],A=o=>o.split(" ").map(u=>u+" - "+r("page.dashboard.peerList.column.flags."+u.trim()));return(o,u)=>{const j=ue("i18n-t"),c=X,p=Ce,I=oe,h=re,v=pe,m=V,K=le,S=He,D=ge;return _(),y(D,{visible:g.value,"onUpdate:visible":u[0]||(u[0]=L=>g.value=L),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(j,{keypath:"page.torrentList.accessHistory.title"},{name:e(()=>[i(l(f.value),1)]),_:1})]),default:e(()=>[t(m,{direction:"vertical",fill:""},{default:e(()=>{var L,C;return[t(c,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.description")),1)]),_:1}),(L=n(P))!=null&&L.data.results||n(N)?(_(),y(K,{key:0,stripe:!0,columns:$,data:(C=n(P))==null?void 0:C.data.results,loading:n(N),pagination:{total:n(w),current:n(M),pageSize:n(B),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:n(T),onPageSizeChange:n(F)},{address:e(({record:a})=>[t(c,{code:"",copyable:"",style:{"white-space":"nowrap"}},{default:e(()=>[t(_e,{ip:a.address,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(l(a.address),1)]),_:2},1032,["ip"])]),_:2},1024)]),downloader:e(({record:a})=>[t(p,{color:n(me)(a.downloader)},{default:e(()=>[i(l(a.downloader),1)]),_:2},1032,["color"])]),peerId:e(({record:a})=>[ee("p",null,[i(l(a.peerId?a.peerId:n(r)("page.banlist.banlist.listItem.empty"))+" ",1),t(I,{content:a.clientName?a.clientName:n(r)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(n(O))]),_:2},1032,["content"])])]),traffic:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(h,{class:"green"}),i(" "+l(n(x)(a.uploaded)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(v,{class:"red"}),i(" "+l(n(x)(a.downloaded)),1)]),_:2},1024)]),_:2},1024)]),offset:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(h,{class:"green"}),i(" "+l(n(x)(a.uploadedOffset)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(v,{class:"red"}),i(" "+l(n(x)(a.downloadedOffset)),1)]),_:2},1024)]),_:2},1024)]),flags:e(({record:a})=>[ee("p",null,[i(l(a.lastFlags)+" ",1),a.lastFlags?(_(),y(I,{key:0},{content:e(()=>[(_(!0),te(de,null,ve(A(a.lastFlags),q=>(_(),te("p",{key:q},l(q),1))),128))]),default:e(()=>[t(n(O))]),_:2},1024)):Se("",!0)])]),time:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.column.timeseen.first"))+": "+l(n(s)(a.firstTimeSeen,"long")),1)]),_:2},1024),t(c,null,{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.column.timeseen.last"))+": "+l(n(s)(a.lastTimeSeen,"long")),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])):(_(),y(S,{key:1,style:{height:"20vh","align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}},{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.empty")),1)]),_:1}))]}),_:1})]),_:1},8,["visible"])}}}),Ke=ne(Ae,[["__scopeId","data-v-051ea996"]]),Me=R({__name:"banHistoryModal",setup(Y,{expose:b}){const r=Q(),{t:s,d:z}=W(),g=k(!1),f=k("");b({showModal:(o,u)=>{f.value=u,U({page:1,pageSize:10,infoHash:o}),g.value=!0}});const{data:P,total:w,current:M,loading:N,pageSize:B,changeCurrent:T,changePageSize:F,runAsync:U}=ae(we,{manual:!0,pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:o=>`${r.endpoint}-torrentBanHistory-${o==null?void 0:o[0].infoHash}-${(o==null?void 0:o[0].page)||1}-${(o==null?void 0:o[0].pageSize)||10}`}),$=[{title:()=>s("page.banlog.banlogTable.column.banTime")+"/"+s("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",width:210},{title:()=>s("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",width:200},{title:()=>s("page.banlog.banlogTable.column.peerId"),slotName:"peerId",width:120},{title:()=>s("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",width:150},{title:()=>s("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],A=J(()=>{var o;return(o=P.value)==null?void 0:o.data.results});return(o,u)=>{const j=ue("i18n-t"),c=X,p=fe,I=xe,h=V,v=re,m=pe,K=ke,S=oe,D=O,L=le,C=ge;return _(),y(C,{visible:g.value,"onUpdate:visible":u[0]||(u[0]=a=>g.value=a),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(j,{keypath:"page.torrentList.banHistory.title"},{name:e(()=>[i(l(f.value),1)]),_:1})]),default:e(()=>[t(h,{direction:"vertical",fill:"",style:{"max-width":"1400px"}},{default:e(()=>[t(c,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(s)("page.torrentList.banHistory.description")),1)]),_:1}),t(L,{stripe:!0,columns:$,data:A.value,loading:n(N),pagination:{total:n(w),current:n(M),pageSize:n(B),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",onPageChange:n(T),onPageSizeChange:n(F)},{banAt:e(({record:a})=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(p),i(" "+l(n(z)(a.banAt,"long")),1)]),_:2},1024),t(c,null,{default:e(()=>[t(I),i(" "+l(a.unbanAt?n(z)(a.unbanAt,"long"):n(s)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:e(({record:a})=>[t(c,{code:""},{default:e(()=>[t(_e,{ip:a.peerIp,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(l(a.peerIp)+":"+l(a.peerPort),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:e(({record:a})=>[t(h,{fill:"",style:{"justify-content":"space-between"}},{default:e(()=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(v,{class:"green"}),i(" "+l(n(x)(a.peerUploaded)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(m,{class:"red"}),i(" "+l(n(x)(a.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),t(S,{content:(a.peerProgress*100).toFixed(2)+"%"},{default:e(()=>[t(K,{percent:a.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:e(({record:a})=>[ee("p",null,[i(l(a.peerId?a.peerId:n(s)("page.banlist.banlist.listItem.empty"))+" ",1),t(S,{content:a.peerClientName?a.peerClientName:n(s)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(D)]),_:2},1032,["content"])])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1})]),_:1},8,["visible"])}}}),Be=ne(Me,[["__scopeId","data-v-4b8de521"]]),Fe=R({__name:"torrentTable",setup(Y){const b=k(!0),r=Q(),{t:s}=W(),{data:z,total:g,current:f,loading:P,pageSize:w,changeCurrent:M,changePageSize:N,refresh:B,run:T}=ae(Le,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:p=>`${r.endpoint}-torrentInfoList-${(p==null?void 0:p[0].page)||1}-${(p==null?void 0:p[0].pageSize)||10}`,onAfter:()=>{b.value=!1}},[he]);ce([w,f],()=>{b.value=!0}),ce(()=>r.endpoint,B);const F=J(()=>b.value||P.value||!$.value),U=[{title:()=>s("page.torrentList.column.name"),dataIndex:"name",ellipsis:!0,tooltip:!0,width:500},{title:"Hash",slotName:"hash",width:340},{title:()=>s("page.torrentList.column.size"),slotName:"size",width:120},{title:()=>s("page.torrentList.column.count"),slotName:"count"},{title:()=>s("page.torrentList.column.actions"),slotName:"action"}],$=J(()=>{var p;return(p=z.value)==null?void 0:p.data.results}),A=k(),o=k(),u=ye.debounce(p=>{T({page:f.value,pageSize:w.value,keyword:p})},300),j=Q(),c=J(()=>j.plusStatus);return(p,I)=>{const h=Pe,v=V,m=X,K=fe,S=oe,D=Ne,L=be,C=$e,a=Te,q=le;return _(),te(de,null,[t(v,{direction:"vertical",fill:""},{default:e(()=>[t(v,{class:"align-right",fill:""},{default:e(()=>[t(h,{style:{width:"250px"},placeholder:n(s)("page.torrentList.accessHistory.searchPlaceholder"),"allow-clear":"","search-button":"",onSearch:n(u),onChange:n(u),onClear:I[0]||(I[0]=d=>n(T)({page:n(f),pageSize:n(w)}))},null,8,["placeholder","onSearch","onChange"])]),_:1}),t(q,{stripe:!0,columns:U,data:$.value,loading:F.value,pagination:{total:n(g),current:n(f),pageSize:n(w),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:n(M),onPageSizeChange:n(N)},{size:e(({record:d})=>[i(l(n(x)(d.size)),1)]),hash:e(({record:d})=>[t(m,{code:"",style:{"white-space":"nowrap"}},{default:e(()=>[i(l(d.infoHash),1)]),_:2},1024)]),count:e(({record:d})=>[t(v,{fill:"",direction:"vertical"},{default:e(()=>[t(S,{content:`${n(s)("page.torrentList.column.count.ban")}: ${d.peerBanCount}`},{default:e(()=>[t(m,null,{default:e(()=>[t(K),i(" "+l(d.peerBanCount),1)]),_:2},1024)]),_:2},1032,["content"]),t(S,{content:`${n(s)("page.torrentList.column.count.access")}: ${d.peerAccessCount}`},{default:e(()=>[t(m,null,{default:e(()=>[t(D),i(" "+l(d.peerAccessCount),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),action:e(({record:d})=>[t(v,{wrap:""},{default:e(()=>{var se,ie;return[t(S,{content:(se=c.value)!=null&&se.activated?n(s)("page.torrentList.column.actions.history"):n(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>{var E;return[t(a,{class:"edit-btn",shape:"circle",type:"text",disabled:!((E=c.value)!=null&&E.activated),onClick:H=>{var G;return(G=A.value)==null?void 0:G.showModal(d.infoHash,d.name)}},{icon:e(()=>{var H;return[(H=c.value)!=null&&H.activated?(_(),y(L,{key:0})):(_(),y(C,{key:1}))]}),_:2},1032,["disabled","onClick"])]}),_:2},1032,["content"]),t(S,{content:(ie=c.value)!=null&&ie.activated?n(s)("page.torrentList.column.actions.ban"):n(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>{var E;return[t(a,{class:"edit-btn",shape:"circle",type:"text",disabled:!((E=c.value)!=null&&E.activated),onClick:H=>{var G;return(G=o.value)==null?void 0:G.showModal(d.infoHash,d.name)}},{icon:e(()=>{var H;return[(H=c.value)!=null&&H.activated?(_(),y(K,{key:0})):(_(),y(C,{key:1}))]}),_:2},1032,["disabled","onClick"])]}),_:2},1032,["content"])]}),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1}),t(Ke,{ref_key:"accessHistoryModal",ref:A},null,512),t(Be,{ref_key:"banHistoryModal",ref:o},null,512)],64)}}}),Ue=ne(Fe,[["__scopeId","data-v-c512f36f"]]),Je=R({__name:"index",setup(Y){const{t:b}=W();return(r,s)=>{const z=X,g=V;return _(),y(g,{direction:"vertical",fill:""},{default:e(()=>[t(z,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(b)("page.torrentList.description")),1)]),_:1}),t(Ue)]),_:1})}}});export{Je as default};
