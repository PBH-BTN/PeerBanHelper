var L=Object.defineProperty;var $=(t,e,a)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var w=(t,e,a)=>$(t,typeof e!="symbol"?e+"":e,a);import{a as k,u as B,g as G,e as z,_ as F}from"./index-N1NEwrRt.js";import{f as H,a6 as j,r as v,a as J,a8 as M,c as P,I as q,j as R,s as y,t as l,a2 as _,y as i,v as d,x as p,u as T}from"./libs-iq95cNh6.js";import{M as W,v as K,S as Q,b as X,T as Y,k as Z,n as ee}from"./arcoDesign-_wCI8yEG.js";var m=(t=>(t.DEBUG="DEBUG",t.INFO="INFO",t.WARN="WARN",t.ERROR="ERROR",t.TRACE="TRACE",t))(m||{});class te{constructor(e,a,u){w(this,"_isOpen",!1);w(this,"ws");w(this,"url");const s=new URL(e);this.url=new URL(k(`${s.protocol==="https:"?"wss":"ws"}://${s.host}${s.pathname}`,a)),this.url.searchParams.append("token",u)}get isOpen(){return this._isOpen}get State(){var e;return((e=this.ws)==null?void 0:e.readyState)??WebSocket.CLOSED}open(e,a,u){var s;try{(s=this.ws)==null||s.close(),this.url.searchParams.append("offset",e.toString()),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this._isOpen=!0},this.ws.onerror=c=>{u(new Error(`WebSocket error: ${c}`))},this.ws.onclose=()=>{this._isOpen=!1},this.ws.onmessage=c=>{try{const f=JSON.parse(c.data);f.success?a(f.data):u(new Error(`WebSocket error: ${f.message}`))}catch{}}}catch(c){return c instanceof Error&&u(c),!1}return!0}close(){var e;this._isOpen&&((e=this.ws)==null||e.close(),this.ws=void 0)}}class se extends te{constructor(){const e=B();super(e.endpoint,"api/logs/stream",e.authToken)}}async function ae(){const t=B();await t.serverAvailable;const e=new URL(k(t.endpoint,"api/logs/history"),location.href);return fetch(e,{headers:G()}).then(a=>(t.assertResponseLogin(a),a.json()))}const oe=H({__name:"logViewer",setup(t){const{t:e,d:a}=j(),u=v(!1),s=J([]),{loading:c}=M(ae,{onSuccess:o=>{s.splice(0,s.length),s.push(...o.data)}}),f=P(()=>u.value?s.filter(o=>o.thread!=="Ban Wave"):s),O=v(),S=new se,b=v(!1),N=async o=>{try{return o?S.open(s.length>0?s[s.length-1].offset:0,r=>{var h;s.push(r),(h=O.value)==null||h.scrollIntoView({index:s.length-1,align:"bottom"})},r=>{W.error(r.message),b.value=!1}):(S.close(),!0)}catch(r){return r instanceof Error&&W.error(r.message),!1}},x=o=>{switch(o){case m.TRACE:return"blue";case m.WARN:return"orange";case m.ERROR:return"red";case m.DEBUG:case m.INFO:default:return"gray"}},A=o=>o.startsWith("virtual-")||o.startsWith("pool")||/Thread-[0-9]+/.test(o)?"gray":z(o,["orange","orangered","red","blue"]);q(()=>{S.close()});const E=v(!0);return(o,r)=>{const h=K,g=Q,V=X,U=Y,C=Z,I=ee;return R(),y(g,{direction:"vertical",class:"container",size:"medium"},{default:l(()=>[_(c)?T("",!0):(R(),y(g,{key:0,size:"large"},{default:l(()=>[i(g,null,{default:l(()=>[i(h,{modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=n=>b.value=n),"before-change":N},null,8,["modelValue"]),d(p(_(e)("page.settings.tab.info.log.enableAutoRefresh")),1)]),_:1}),i(g,null,{default:l(()=>[i(h,{modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=n=>u.value=n)},null,8,["modelValue"]),d(p(_(e)("page.settings.tab.info.log.hideBanWave")),1)]),_:1}),i(g,null,{default:l(()=>[i(h,{modelValue:E.value,"onUpdate:modelValue":r[2]||(r[2]=n=>E.value=n)},null,8,["modelValue"]),d(p(_(e)("page.settings.tab.info.log.showThread")),1)]),_:1})]),_:1})),i(I,{ref_key:"logList",ref:O,size:"small",loading:_(c),scrollbar:"","virtual-list-props":{height:700,buffer:20},data:f.value},{item:l(({item:n,index:D})=>[(R(),y(C,{key:D},{default:l(()=>[i(g,{class:"log-line",fill:""},{default:l(()=>[i(V,{class:"level-tag",color:x(n.level)},{default:l(()=>[d(p(n.level),1)]),_:2},1032,["color"]),i(V,null,{default:l(()=>[d(p(_(a)(n.time,"log")),1)]),_:2},1024),E.value?(R(),y(V,{key:0,color:A(n.thread)},{default:l(()=>[d(p(n.thread),1)]),_:2},1032,["color"])):T("",!0),i(U,{ellipsis:{rows:1,showTooltip:!0}},{default:l(()=>[d(p(n.content),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))]),_:1},8,["loading","data"])]),_:1})}}}),ue=F(oe,[["__scopeId","data-v-d01f93ae"]]);export{ue as default};
