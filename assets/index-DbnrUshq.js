import{u as q,b as se,c as le,I as V,f as N,h as _e,_ as ee,d as ge,l as me,i as fe,e as be}from"./index-DgfpHrne.js";import{f as J,a8 as Q,a as C,aa as te,s as S,t as e,y as t,v as l,x as o,a9 as a,a3 as X,m as Y,u as he,j as Z,F as ie,P as ye,q as re,k as _,c as O,w as oe}from"./libs-CGCN05bf.js";import{G as ve,a as Se,b as ze}from"./data-DUVRGiDC.js";import{_ as ce}from"./queryIpLink.vue_vue_type_script_setup_true_lang-UXcGrBiH.js";import{G as pe,S as j,T as R,v as ae,e as ne,c as Ie,E as we,ab as xe,N as Ce,a8 as Le,j as He,f as Pe,au as ke}from"./arcoDesign-oXuB2kqy.js";import{I as de}from"./index-C2gOs6jd.js";import{I as $e}from"./index-4IWmHI0u.js";import"./uuid-BMzgKRou.js";const Ne=J({__name:"accessHistoryModal",setup(W,{expose:z}){const{t:d,d:s}=Q(),L=q(),b=C(!1),g=C(""),H=C("");z({showModal:(i,p)=>{H.value=p,g.value=i,y({page:1,pageSize:10,infoHash:i}),b.value=!0}});const{data:h,total:T,current:I,loading:A,pageSize:m,changeCurrent:B,changePageSize:U,runAsync:y}=te(ve,{pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},manual:!0,cacheKey:i=>`${L.endpoint}-torrentAccessHistory-${i?.[0].infoHash}-${i?.[0].page||1}-${i?.[0].pageSize||10}`}),D=[{title:()=>d("page.torrentList.accessHistory.column.downloader"),slotName:"downloader",dataIndex:"downloader",sortable:{sortDirections:["ascend","descend"],sorter:!0}},{title:()=>d("page.torrentList.accessHistory.column.address"),slotName:"address",dataIndex:"address",sortable:{sortDirections:["ascend","descend"],sorter:!0}},{title:"Peer ID",slotName:"peerId",dataIndex:"peerId",sortable:{sortDirections:["ascend","descend"],sorter:!0}},{title:()=>d("page.torrentList.accessHistory.column.traffic"),slotName:"traffic",dataIndex:"uploaded",sortable:{sortDirections:["ascend","descend"],sorter:!0}},{title:()=>X(j,[d("page.torrentList.accessHistory.column.offset"),X(xe,{content:d("page.torrentList.accessHistory.column.offsetDescription")},()=>X(V))]),slotName:"offset"},{title:"Flags",slotName:"flags",dataIndex:"lastFlags",sortable:{sortDirections:["ascend","descend"],sorter:!0}},{title:()=>d("page.torrentList.accessHistory.column.timeseen"),slotName:"time",dataIndex:"firstTimeSeen",sortable:{sortDirections:["ascend","descend"],sorter:!0}}],M=i=>i.split(" ").map(p=>p+" - "+d("page.dashboard.peerList.column.flags."+p.trim())),v=(i,p)=>{y(p?{page:I.value,pageSize:m.value,infoHash:g.value,sorter:`${i}|${p}`}:{page:I.value,pageSize:m.value,infoHash:g.value})};return(i,p)=>{const E=re("i18n-t"),r=R,w=Ie,F=ne,f=se,P=le,x=j,k=ae,K=we,G=pe;return _(),S(G,{visible:b.value,"onUpdate:visible":p[0]||(p[0]=n=>b.value=n),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(E,{keypath:"page.torrentList.accessHistory.title"},{name:e(()=>[l(o(H.value),1)]),_:1})]),default:e(()=>[t(x,{direction:"vertical",fill:""},{default:e(()=>[t(r,{style:{"font-size":"1.2em"}},{default:e(()=>[l(o(a(d)("page.torrentList.accessHistory.description")),1)]),_:1}),a(h)?.data.results||a(A)?(_(),S(k,{key:0,stripe:!0,columns:D,data:a(h)?.data.results,loading:a(A),pagination:{total:a(T),current:a(I),pageSize:a(m),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:a(B),onSorterChange:v,onPageSizeChange:a(U)},{address:e(({record:n})=>[t(r,{code:"",copyable:"",style:{"white-space":"nowrap"}},{default:e(()=>[t(ce,{ip:n.address,style:{color:"var(--color-text-2)"}},{default:e(()=>[l(o(n.address),1)]),_:2},1032,["ip"])]),_:2},1024)]),downloader:e(({record:n})=>[t(w,{color:a(_e)(n.downloader.id)},{default:e(()=>[l(o(n.downloader.name),1)]),_:2},1032,["color"])]),peerId:e(({record:n})=>[Y("p",null,[l(o(n.peerId?n.peerId:a(d)("page.banlist.banlist.listItem.empty"))+" ",1),t(F,{content:n.clientName?n.clientName:a(d)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(a(V))]),_:1},8,["content"])])]),traffic:e(({record:n})=>[t(x,{fill:"",direction:"vertical"},{default:e(()=>[t(r,null,{default:e(()=>[t(f,{class:"green"}),l(" "+o(a(N)(n.uploaded)),1)]),_:2},1024),t(r,null,{default:e(()=>[t(P,{class:"red"}),l(" "+o(a(N)(n.downloaded)),1)]),_:2},1024)]),_:2},1024)]),offset:e(({record:n})=>[t(x,{fill:"",direction:"vertical"},{default:e(()=>[t(r,null,{default:e(()=>[t(f,{class:"green"}),l(" "+o(a(N)(n.uploadedOffset)),1)]),_:2},1024),t(r,null,{default:e(()=>[t(P,{class:"red"}),l(" "+o(a(N)(n.downloadedOffset)),1)]),_:2},1024)]),_:2},1024)]),flags:e(({record:n})=>[Y("p",null,[l(o(n.lastFlags)+" ",1),n.lastFlags?(_(),S(F,{key:0},{content:e(()=>[(_(!0),Z(ie,null,ye(M(n.lastFlags),$=>(_(),Z("p",{key:$},o($),1))),128))]),default:e(()=>[t(a(V))]),_:2},1024)):he("",!0)])]),time:e(({record:n})=>[t(x,{fill:"",direction:"vertical"},{default:e(()=>[t(r,null,{default:e(()=>[l(o(a(d)("page.torrentList.accessHistory.column.timeseen.first"))+": "+o(a(s)(n.firstTimeSeen,"long")),1)]),_:2},1024),t(r,null,{default:e(()=>[l(o(a(d)("page.torrentList.accessHistory.column.timeseen.last"))+": "+o(a(s)(n.lastTimeSeen,"long")),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])):(_(),S(K,{key:1,style:{height:"20vh","align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}},{default:e(()=>[l(o(a(d)("page.torrentList.accessHistory.empty")),1)]),_:1}))]),_:1})]),_:1},8,["visible"])}}}),Te=ee(Ne,[["__scopeId","data-v-ab547a5f"]]),Ae=J({__name:"banHistoryModal",setup(W,{expose:z}){const d=q(),{t:s,d:L}=Q(),b=C(!1),g=C(""),H=C("");z({showModal:(i,p)=>{g.value=p,H.value=i,y({page:1,pageSize:10,infoHash:i}),b.value=!0}});const{data:h,total:T,current:I,loading:A,pageSize:m,changeCurrent:B,changePageSize:U,runAsync:y}=te(Se,{manual:!0,pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:i=>`${d.endpoint}-torrentBanHistory-${i?.[0].infoHash}-${i?.[0].page||1}-${i?.[0].pageSize||10}`}),D=[{title:()=>s("page.banlog.banlogTable.column.banTime")+"/"+s("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",dataIndex:"banAt",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:210},{title:()=>s("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",dataIndex:"peerIp",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:200},{title:()=>s("page.banlog.banlogTable.column.peerId"),slotName:"peerId",dataIndex:"peerId",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:120},{title:()=>s("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",dataIndex:"peerUploaded",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:150},{title:()=>s("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],M=(i,p)=>{y(p?{page:I.value,pageSize:m.value,infoHash:H.value,sorter:`${i}|${p}`}:{page:I.value,pageSize:m.value,infoHash:H.value})},v=O(()=>h.value?.data.results);return(i,p)=>{const E=re("i18n-t"),r=R,w=de,F=Le,f=j,P=se,x=le,k=Ce,K=ne,G=V,n=ae,$=pe;return _(),S($,{visible:b.value,"onUpdate:visible":p[0]||(p[0]=c=>b.value=c),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(E,{keypath:"page.torrentList.banHistory.title"},{name:e(()=>[l(o(g.value),1)]),_:1})]),default:e(()=>[t(f,{direction:"vertical",fill:"",style:{"max-width":"1400px"}},{default:e(()=>[t(r,{style:{"font-size":"1.2em"}},{default:e(()=>[l(o(a(s)("page.torrentList.banHistory.description")),1)]),_:1}),t(n,{stripe:!0,columns:D,data:v.value,loading:a(A),pagination:{total:a(T),current:a(I),pageSize:a(m),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",onPageChange:a(B),onSorterChange:M,onPageSizeChange:a(U)},{banAt:e(({record:c})=>[t(f,{fill:"",direction:"vertical"},{default:e(()=>[t(r,null,{default:e(()=>[t(w),l(" "+o(a(L)(c.banAt,"long")),1)]),_:2},1024),t(r,null,{default:e(()=>[t(F),l(" "+o(c.unbanAt?a(L)(c.unbanAt,"long"):a(s)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:e(({record:c})=>[t(r,{code:""},{default:e(()=>[t(ce,{ip:c.peerIp,style:{color:"var(--color-text-2)"}},{default:e(()=>[l(o(a(ge)(c.peerIp,c.peerPort)),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:e(({record:c})=>[t(f,{fill:"",style:{"justify-content":"space-between"}},{default:e(()=>[t(f,{fill:"",direction:"vertical"},{default:e(()=>[t(r,null,{default:e(()=>[t(P,{class:"green"}),l(" "+o(a(N)(c.peerUploaded)),1)]),_:2},1024),t(r,null,{default:e(()=>[t(x,{class:"red"}),l(" "+o(a(N)(c.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),t(K,{content:(c.peerProgress*100).toFixed(2)+"%"},{default:e(()=>[t(k,{percent:c.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:e(({record:c})=>[Y("p",null,[l(o(c.peerId?c.peerId:a(s)("page.banlist.banlist.listItem.empty"))+" ",1),t(K,{content:c.peerClientName?c.peerClientName:a(s)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(G)]),_:1},8,["content"])])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1})]),_:1},8,["visible"])}}}),De=ee(Ae,[["__scopeId","data-v-3dfcf757"]]),Me=J({__name:"torrentTable",setup(W){const z=C(!0),d=q(),{t:s}=Q(),{data:L,total:b,current:g,loading:H,pageSize:h,changeCurrent:T,changePageSize:I,refresh:A,run:m}=te(ze,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:r=>`${d.endpoint}-torrentInfoList-${r?.[0].page||1}-${r?.[0].pageSize||10}`,onAfter:()=>{z.value=!1}},[be]);oe([h,g],()=>{z.value=!0}),oe(()=>d.endpoint,A);const B=O(()=>z.value||H.value||!y.value),U=[{title:()=>s("page.torrentList.column.name"),dataIndex:"name",sortable:{sortDirections:["ascend","descend"],sorter:!0},ellipsis:!0,tooltip:!0,width:500},{title:"Hash",slotName:"hash",dataIndex:"infoHash",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:340},{title:()=>s("page.torrentList.column.size"),slotName:"size",dataIndex:"size",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:120},{title:()=>s("page.torrentList.column.count"),slotName:"count"},{title:()=>s("page.torrentList.column.actions"),slotName:"action"}],y=O(()=>L.value?.data.results),D=C(),M=C(),v=O(()=>p.plusStatus?.enabledFeatures?.includes("basic")),i=me.debounce(r=>{T(1),m({page:1,pageSize:h.value,keyword:r})},300),p=q(),E=(r,w)=>{m(w?{page:g.value,pageSize:h.value,sorter:`${r}|${w}`}:{page:g.value,pageSize:h.value})};return(r,w)=>{const F=He,f=j,P=R,x=de,k=ne,K=ke,G=fe,n=$e,$=Pe,c=ae;return _(),Z(ie,null,[t(f,{direction:"vertical",fill:""},{default:e(()=>[t(f,{class:"align-right",fill:""},{default:e(()=>[t(F,{style:{width:"250px"},placeholder:a(s)("page.torrentList.accessHistory.searchPlaceholder"),"allow-clear":"","search-button":"",onSearch:a(i),onChange:a(i),onClear:w[0]||(w[0]=u=>a(m)({page:a(g),pageSize:a(h)}))},null,8,["placeholder","onSearch","onChange"])]),_:1}),t(c,{stripe:!0,columns:U,data:y.value,loading:B.value,pagination:{total:a(b),current:a(g),pageSize:a(h),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onSorterChange:E,onPageChange:a(T),onPageSizeChange:a(I)},{size:e(({record:u})=>[l(o(a(N)(u.size)),1)]),hash:e(({record:u})=>[t(P,{code:"",style:{"white-space":"nowrap"}},{default:e(()=>[l(o(u.infoHash),1)]),_:2},1024)]),count:e(({record:u})=>[t(f,{fill:"",direction:"vertical"},{default:e(()=>[t(k,{content:`${a(s)("page.torrentList.column.count.ban")}: ${u.peerBanCount}`},{default:e(()=>[t(P,null,{default:e(()=>[t(x),l(" "+o(u.peerBanCount),1)]),_:2},1024)]),_:2},1032,["content"]),t(k,{content:`${a(s)("page.torrentList.column.count.access")}: ${u.peerAccessCount}`},{default:e(()=>[t(P,null,{default:e(()=>[t(K),l(" "+o(u.peerAccessCount),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),action:e(({record:u})=>[t(f,{wrap:""},{default:e(()=>[t(k,{content:v.value?a(s)("page.torrentList.column.actions.history"):a(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>[t($,{class:"edit-btn",shape:"circle",type:"text",disabled:!v.value,onClick:ue=>D.value?.showModal(u.infoHash,u.name)},{icon:e(()=>[v.value?(_(),S(G,{key:0})):(_(),S(n,{key:1}))]),_:1},8,["disabled","onClick"])]),_:2},1032,["content"]),t(k,{content:v.value?a(s)("page.torrentList.column.actions.ban"):a(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>[t($,{class:"edit-btn",shape:"circle",type:"text",disabled:!v.value,onClick:ue=>M.value?.showModal(u.infoHash,u.name)},{icon:e(()=>[v.value?(_(),S(x,{key:0})):(_(),S(n,{key:1}))]),_:1},8,["disabled","onClick"])]),_:2},1032,["content"])]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1}),t(Te,{ref_key:"accessHistoryModal",ref:D},null,512),t(De,{ref_key:"banHistoryModal",ref:M},null,512)],64)}}}),Fe=ee(Me,[["__scopeId","data-v-dca33713"]]),qe=J({__name:"index",setup(W){const{t:z}=Q();return(d,s)=>{const L=R,b=j;return _(),S(b,{direction:"vertical",fill:""},{default:e(()=>[t(L,{style:{"font-size":"1.2em"}},{default:e(()=>[l(o(a(z)("page.torrentList.description")),1)]),_:1}),t(Fe)]),_:1})}}});export{qe as default};
