import{u as Q,b as re,c as pe,I as q,f as P,h as me,_ as ne,d as ye,l as be,i as he,e as ve}from"./index-u_sksyXT.js";import{f as R,a7 as W,a as k,ak as ae,s as y,t as e,y as t,v as i,x as l,a3 as n,a1 as Z,m as ee,u as Se,j as te,F as ue,P as ze,q as de,k as _,c as J,w as ce}from"./libs-BMxpkVOl.js";import{G as we,a as Le,b as Ie}from"./data-YBoAZNxM.js";import{_ as _e}from"./queryIpLink.vue_vue_type_script_setup_true_lang-C6arf18q.js";import{F as ge,S as V,T as X,t as oe,e as le,c as Ce,E as He,a9 as Pe,K as ke,a5 as xe,j as Ne,f as Te,as as $e}from"./arcoDesign-D0ixelLT.js";import{I as fe}from"./index-OXHYTrGU.js";import{I as Ae}from"./index-DCSmKXz4.js";const Ke=R({__name:"accessHistoryModal",setup(Y,{expose:b}){const{t:r,d:s}=W(),z=Q(),g=k(!1),f=k("");b({showModal:(o,u)=>{f.value=u,U({page:1,pageSize:10,infoHash:o}),g.value=!0}});const{data:x,total:w,current:M,loading:N,pageSize:B,changeCurrent:T,changePageSize:F,runAsync:U}=ae(we,{pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},manual:!0,cacheKey:o=>`${z.endpoint}-torrentAccessHistory-${o==null?void 0:o[0].infoHash}-${(o==null?void 0:o[0].page)||1}-${(o==null?void 0:o[0].pageSize)||10}`}),$=[{title:()=>r("page.torrentList.accessHistory.column.downloader"),slotName:"downloader"},{title:()=>r("page.torrentList.accessHistory.column.address"),slotName:"address"},{title:"Peer ID",slotName:"peerId"},{title:()=>r("page.torrentList.accessHistory.column.traffic"),slotName:"traffic"},{title:()=>Z(V,[r("page.torrentList.accessHistory.column.offset"),Z(Pe,{content:r("page.torrentList.accessHistory.column.offsetDescription")},()=>Z(q))]),slotName:"offset"},{title:"Flags",slotName:"flags"},{title:()=>r("page.torrentList.accessHistory.column.timeseen"),slotName:"time"}],A=o=>o.split(" ").map(u=>u+" - "+r("page.dashboard.peerList.column.flags."+u.trim()));return(o,u)=>{const D=de("i18n-t"),c=X,p=Ce,I=le,h=re,v=pe,m=V,K=oe,S=He,E=ge;return _(),y(E,{visible:g.value,"onUpdate:visible":u[0]||(u[0]=L=>g.value=L),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(D,{keypath:"page.torrentList.accessHistory.title"},{name:e(()=>[i(l(f.value),1)]),_:1})]),default:e(()=>[t(m,{direction:"vertical",fill:""},{default:e(()=>{var L,C;return[t(c,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.description")),1)]),_:1}),(L=n(x))!=null&&L.data.results||n(N)?(_(),y(K,{key:0,stripe:!0,columns:$,data:(C=n(x))==null?void 0:C.data.results,loading:n(N),pagination:{total:n(w),current:n(M),pageSize:n(B),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:n(T),onPageSizeChange:n(F)},{address:e(({record:a})=>[t(c,{code:"",copyable:"",style:{"white-space":"nowrap"}},{default:e(()=>[t(_e,{ip:a.address,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(l(a.address),1)]),_:2},1032,["ip"])]),_:2},1024)]),downloader:e(({record:a})=>[t(p,{color:n(me)(a.downloader)},{default:e(()=>[i(l(a.downloader),1)]),_:2},1032,["color"])]),peerId:e(({record:a})=>[ee("p",null,[i(l(a.peerId?a.peerId:n(r)("page.banlist.banlist.listItem.empty"))+" ",1),t(I,{content:a.clientName?a.clientName:n(r)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(n(q))]),_:2},1032,["content"])])]),traffic:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(h,{class:"green"}),i(" "+l(n(P)(a.uploaded)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(v,{class:"red"}),i(" "+l(n(P)(a.downloaded)),1)]),_:2},1024)]),_:2},1024)]),offset:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(h,{class:"green"}),i(" "+l(n(P)(a.uploadedOffset)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(v,{class:"red"}),i(" "+l(n(P)(a.downloadedOffset)),1)]),_:2},1024)]),_:2},1024)]),flags:e(({record:a})=>[ee("p",null,[i(l(a.lastFlags)+" ",1),a.lastFlags?(_(),y(I,{key:0},{content:e(()=>[(_(!0),te(ue,null,ze(A(a.lastFlags),O=>(_(),te("p",{key:O},l(O),1))),128))]),default:e(()=>[t(n(q))]),_:2},1024)):Se("",!0)])]),time:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.column.timeseen.first"))+": "+l(n(s)(a.firstTimeSeen,"long")),1)]),_:2},1024),t(c,null,{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.column.timeseen.last"))+": "+l(n(s)(a.lastTimeSeen,"long")),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])):(_(),y(S,{key:1,style:{height:"20vh","align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}},{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.empty")),1)]),_:1}))]}),_:1})]),_:1},8,["visible"])}}}),Me=ne(Ke,[["__scopeId","data-v-051ea996"]]),Be=R({__name:"banHistoryModal",setup(Y,{expose:b}){const r=Q(),{t:s,d:z}=W(),g=k(!1),f=k("");b({showModal:(o,u)=>{f.value=u,U({page:1,pageSize:10,infoHash:o}),g.value=!0}});const{data:x,total:w,current:M,loading:N,pageSize:B,changeCurrent:T,changePageSize:F,runAsync:U}=ae(Le,{manual:!0,pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:o=>`${r.endpoint}-torrentBanHistory-${o==null?void 0:o[0].infoHash}-${(o==null?void 0:o[0].page)||1}-${(o==null?void 0:o[0].pageSize)||10}`}),$=[{title:()=>s("page.banlog.banlogTable.column.banTime")+"/"+s("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",width:210},{title:()=>s("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",width:200},{title:()=>s("page.banlog.banlogTable.column.peerId"),slotName:"peerId",width:120},{title:()=>s("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",width:150},{title:()=>s("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],A=J(()=>{var o;return(o=x.value)==null?void 0:o.data.results});return(o,u)=>{const D=de("i18n-t"),c=X,p=fe,I=xe,h=V,v=re,m=pe,K=ke,S=le,E=q,L=oe,C=ge;return _(),y(C,{visible:g.value,"onUpdate:visible":u[0]||(u[0]=a=>g.value=a),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(D,{keypath:"page.torrentList.banHistory.title"},{name:e(()=>[i(l(f.value),1)]),_:1})]),default:e(()=>[t(h,{direction:"vertical",fill:"",style:{"max-width":"1400px"}},{default:e(()=>[t(c,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(s)("page.torrentList.banHistory.description")),1)]),_:1}),t(L,{stripe:!0,columns:$,data:A.value,loading:n(N),pagination:{total:n(w),current:n(M),pageSize:n(B),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",onPageChange:n(T),onPageSizeChange:n(F)},{banAt:e(({record:a})=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(p),i(" "+l(n(z)(a.banAt,"long")),1)]),_:2},1024),t(c,null,{default:e(()=>[t(I),i(" "+l(a.unbanAt?n(z)(a.unbanAt,"long"):n(s)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:e(({record:a})=>[t(c,{code:""},{default:e(()=>[t(_e,{ip:a.peerIp,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(l(n(ye)(a.peerIp,a.peerPort)),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:e(({record:a})=>[t(h,{fill:"",style:{"justify-content":"space-between"}},{default:e(()=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(v,{class:"green"}),i(" "+l(n(P)(a.peerUploaded)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(m,{class:"red"}),i(" "+l(n(P)(a.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),t(S,{content:(a.peerProgress*100).toFixed(2)+"%"},{default:e(()=>[t(K,{percent:a.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:e(({record:a})=>[ee("p",null,[i(l(a.peerId?a.peerId:n(s)("page.banlist.banlist.listItem.empty"))+" ",1),t(S,{content:a.peerClientName?a.peerClientName:n(s)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(E)]),_:2},1032,["content"])])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1})]),_:1},8,["visible"])}}}),Fe=ne(Be,[["__scopeId","data-v-3312fa15"]]),Ue=R({__name:"torrentTable",setup(Y){const b=k(!0),r=Q(),{t:s}=W(),{data:z,total:g,current:f,loading:x,pageSize:w,changeCurrent:M,changePageSize:N,refresh:B,run:T}=ae(Ie,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:p=>`${r.endpoint}-torrentInfoList-${(p==null?void 0:p[0].page)||1}-${(p==null?void 0:p[0].pageSize)||10}`,onAfter:()=>{b.value=!1}},[ve]);ce([w,f],()=>{b.value=!0}),ce(()=>r.endpoint,B);const F=J(()=>b.value||x.value||!$.value),U=[{title:()=>s("page.torrentList.column.name"),dataIndex:"name",ellipsis:!0,tooltip:!0,width:500},{title:"Hash",slotName:"hash",width:340},{title:()=>s("page.torrentList.column.size"),slotName:"size",width:120},{title:()=>s("page.torrentList.column.count"),slotName:"count"},{title:()=>s("page.torrentList.column.actions"),slotName:"action"}],$=J(()=>{var p;return(p=z.value)==null?void 0:p.data.results}),A=k(),o=k(),u=be.debounce(p=>{T({page:f.value,pageSize:w.value,keyword:p})},300),D=Q(),c=J(()=>D.plusStatus);return(p,I)=>{const h=Ne,v=V,m=X,K=fe,S=le,E=$e,L=he,C=Ae,a=Te,O=oe;return _(),te(ue,null,[t(v,{direction:"vertical",fill:""},{default:e(()=>[t(v,{class:"align-right",fill:""},{default:e(()=>[t(h,{style:{width:"250px"},placeholder:n(s)("page.torrentList.accessHistory.searchPlaceholder"),"allow-clear":"","search-button":"",onSearch:n(u),onChange:n(u),onClear:I[0]||(I[0]=d=>n(T)({page:n(f),pageSize:n(w)}))},null,8,["placeholder","onSearch","onChange"])]),_:1}),t(O,{stripe:!0,columns:U,data:$.value,loading:F.value,pagination:{total:n(g),current:n(f),pageSize:n(w),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:n(M),onPageSizeChange:n(N)},{size:e(({record:d})=>[i(l(n(P)(d.size)),1)]),hash:e(({record:d})=>[t(m,{code:"",style:{"white-space":"nowrap"}},{default:e(()=>[i(l(d.infoHash),1)]),_:2},1024)]),count:e(({record:d})=>[t(v,{fill:"",direction:"vertical"},{default:e(()=>[t(S,{content:`${n(s)("page.torrentList.column.count.ban")}: ${d.peerBanCount}`},{default:e(()=>[t(m,null,{default:e(()=>[t(K),i(" "+l(d.peerBanCount),1)]),_:2},1024)]),_:2},1032,["content"]),t(S,{content:`${n(s)("page.torrentList.column.count.access")}: ${d.peerAccessCount}`},{default:e(()=>[t(m,null,{default:e(()=>[t(E),i(" "+l(d.peerAccessCount),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),action:e(({record:d})=>[t(v,{wrap:""},{default:e(()=>{var se,ie;return[t(S,{content:(se=c.value)!=null&&se.activated?n(s)("page.torrentList.column.actions.history"):n(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>{var j;return[t(a,{class:"edit-btn",shape:"circle",type:"text",disabled:!((j=c.value)!=null&&j.activated),onClick:H=>{var G;return(G=A.value)==null?void 0:G.showModal(d.infoHash,d.name)}},{icon:e(()=>{var H;return[(H=c.value)!=null&&H.activated?(_(),y(L,{key:0})):(_(),y(C,{key:1}))]}),_:2},1032,["disabled","onClick"])]}),_:2},1032,["content"]),t(S,{content:(ie=c.value)!=null&&ie.activated?n(s)("page.torrentList.column.actions.ban"):n(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>{var j;return[t(a,{class:"edit-btn",shape:"circle",type:"text",disabled:!((j=c.value)!=null&&j.activated),onClick:H=>{var G;return(G=o.value)==null?void 0:G.showModal(d.infoHash,d.name)}},{icon:e(()=>{var H;return[(H=c.value)!=null&&H.activated?(_(),y(K,{key:0})):(_(),y(C,{key:1}))]}),_:2},1032,["disabled","onClick"])]}),_:2},1032,["content"])]}),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1}),t(Me,{ref_key:"accessHistoryModal",ref:A},null,512),t(Fe,{ref_key:"banHistoryModal",ref:o},null,512)],64)}}}),De=ne(Ue,[["__scopeId","data-v-c512f36f"]]),Qe=R({__name:"index",setup(Y){const{t:b}=W();return(r,s)=>{const z=X,g=V;return _(),y(g,{direction:"vertical",fill:""},{default:e(()=>[t(z,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(b)("page.torrentList.description")),1)]),_:1}),t(De)]),_:1})}}});export{Qe as default};
