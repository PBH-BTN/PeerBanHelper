import{u as w,a as q,g as G,f as M,b as f,I as O,c as Q,d as W,e as X,_ as T}from"./index-B1WcpjWy.js";import{_ as Y}from"./queryIpLink.vue_vue_type_script_setup_true_lang-DlxahBco.js";import{f as v,r as Z,a6 as P,aj as ee,w as z,c as I,j as x,s as A,t as a,y as t,v as c,x as i,a2 as o,p as y}from"./libs-JpPrnt1f.js";import{I as te}from"./index-DNa9nT6p.js";import{T as C,a6 as ae,S as N,K as ne,c as oe,t as le}from"./arcoDesign-CRPk19aq.js";async function se(p){const s=w();await s.serverAvailable;const r=new URL(q(s.endpoint,"api/bans/logs"),location.href);return r.searchParams.set("page",String(p.page)),p.pageSize&&r.searchParams.set("pageSize",String(p.pageSize)),fetch(r,{headers:G()}).then(n=>(s.assertResponseLogin(n),n.json()))}const ie=v({__name:"banlogTable",setup(p){const s=Z(!0),r=w(),{t:n,d:u}=P(),{data:_,total:$,current:m,loading:K,pageSize:S,changeCurrent:U,changePageSize:j,refresh:k}=ee(se,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:l=>`${r.endpoint}-banlogs-${(l==null?void 0:l[0].page)||1}-${(l==null?void 0:l[0].pageSize)||10}`,onAfter:()=>{s.value=!1}},[X]);z([S,m],()=>{s.value=!0}),z(()=>r.endpoint,k);const B=I(()=>s.value||K.value||!h.value),L=[{title:()=>n("page.banlog.banlogTable.column.banTime")+"/"+n("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",width:210},{title:()=>n("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",width:230},{title:()=>n("page.banlog.banlogTable.column.peerId"),slotName:"peerId",width:120},{title:()=>n("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",width:150},{title:()=>n("page.banlog.banlogTable.column.torrentName"),dataIndex:"torrentName",ellipsis:!0,tooltip:!0},{title:()=>n("page.banlog.banlogTable.column.torrentSize"),slotName:"torrentSize",width:120},{title:()=>n("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],h=I(()=>{var l;return(l=_.value)==null?void 0:l.data.results});return(l,pe)=>{const D=te,g=C,H=ae,d=N,V=O,F=Q,R=ne,b=oe,E=W,J=le;return x(),A(J,{stripe:!0,columns:L,data:h.value,loading:B.value,pagination:{total:o($),current:o(m),pageSize:o(S),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:o(U),onPageSizeChange:o(j)},{banAt:a(({record:e})=>[t(d,{fill:"",direction:"vertical"},{default:a(()=>[t(g,null,{default:a(()=>[t(D),c(" "+i(o(u)(e.banAt,"long")),1)]),_:2},1024),t(g,null,{default:a(()=>[t(H),c(" "+i(e.unbanAt?o(u)(e.unbanAt,"long"):o(n)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:a(({record:e})=>[t(g,{copyable:"",code:""},{default:a(()=>[t(Y,{ip:e.peerIp,style:{color:"var(--color-text-2)"}},{default:a(()=>[c(i(o(M)(e.peerIp,e.peerPort)),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:a(({record:e})=>[t(d,{fill:"",style:{"justify-content":"space-between"}},{default:a(()=>[t(d,{fill:"",direction:"vertical"},{default:a(()=>[t(g,null,{default:a(()=>[t(V,{class:"green"}),c(" "+i(o(f)(e.peerUploaded)),1)]),_:2},1024),t(g,null,{default:a(()=>[t(F,{class:"red"}),c(" "+i(o(f)(e.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),t(b,{content:(e.peerProgress*100).toFixed(2)+"%"},{default:a(()=>[t(R,{percent:e.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:a(({record:e})=>[y("p",null,[c(i(e.peerId?e.peerId:o(n)("page.banlist.banlist.listItem.empty"))+" ",1),t(b,{content:e.peerClientName?e.peerClientName:o(n)("page.banlist.banlist.listItem.empty")},{default:a(()=>[t(E)]),_:2},1032,["content"])])]),torrentSize:a(({record:e})=>[t(b,{content:`Hash: ${e.torrentInfoHash}`},{default:a(()=>[y("p",null,i(o(f)(e.torrentSize)),1)]),_:2},1032,["content"])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])}}}),re=T(ie,[["__scopeId","data-v-0fdeee12"]]),ce=v({__name:"index",setup(p){const{t:s}=P();return(r,n)=>{const u=C,_=N;return x(),A(_,{direction:"vertical",fill:""},{default:a(()=>[t(u,{style:{"font-size":"1.2em"}},{default:a(()=>[c(i(o(s)("page.banlog.description")),1)]),_:1}),t(re)]),_:1})}}}),fe=T(ce,[["__scopeId","data-v-e1fde76f"]]);export{fe as default};
